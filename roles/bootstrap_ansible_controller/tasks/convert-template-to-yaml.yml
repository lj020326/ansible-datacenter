---
- name: Get existing template
  ansible.builtin.set_fact:
    __retrieved_job_template: "{{ lookup('ansible.controller.controller_api', 'job_templates', query_params={'name': template_name}) }}"

- name: Ensure that job template exists
  ansible.builtin.assert:
    that: __retrieved_job_template | length != 0
    quiet: true
    fail_msg: "Job template {{ template_name }} not found in {{ lookup('ansible.builtin.env', 'TOWER_HOST') }}"

- name: Output yaml
  ansible.builtin.debug:
    msg: "{{ lookup('template', 'job-template-yaml.j2').split('\n')}}"
