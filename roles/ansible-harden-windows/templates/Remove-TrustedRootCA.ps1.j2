{{ ansible_managed | comment }}
## from https://cyber-defense.sans.org/blog/2013/07/29/powershell-scripts-to-audit-and-remove-trusted-root-ca-certificates
## https://github.com/EnclaveConsulting/SANS-SEC505/blob/master/SEC505-Scripts.zip
## Note: Review base on what you NEED / USE!
## FIXME! any option to untrust those CA and not remove them?
####################################################################################
#.Synopsis
#    Delete chosen trusted root CA certificates.
#
#.Description
#    Edit the $BadCerts array in this script prior to execution.  The $BadCerts
#    array contains the hash thumbprints of root Certification Authority (CA)
#    certificates which should be deleted.  The script writes its report to the
#    shell and also to the Application event log (Event ID = 9019).
#
#Requires -Version 2.0
#
#.Notes
#  Author: Jason Fossen, Enclave Consulting LLC (http://www.sans.org/sec505)
# Version: 1.1
# Updated: 5.Apr.2015
#   LEGAL: PUBLIC DOMAIN.  SCRIPT PROVIDED "AS IS" WITH NO WARRANTIES OR GUARANTEES OF
#          ANY KIND, INCLUDING BUT NOT LIMITED TO MERCHANTABILITY AND/OR FITNESS FOR
#          A PARTICULAR PURPOSE.  ALL RISKS OF DAMAGE REMAINS WITH THE USER, EVEN IF
#          THE AUTHOR, SUPPLIER OR DISTRIBUTOR HAS BEEN ADVISED OF THE POSSIBILITY OF
#          ANY SUCH DAMAGE.  IF YOUR STATE DOES NOT PERMIT THE COMPLETE LIMITATION OF
#          LIABILITY, THEN DELETE THIS FILE SINCE YOU ARE NOW PROHIBITED TO HAVE IT.
####################################################################################


# The following is the array of the hash thumbprints of
# the CA certificates to delete. Edit this array before
# pushing out the script, the following hashes are just
# examples for the sake of demonstrations.

$BadCerts = @(
  #Example: An expired Belgacom E-Trust cert repeated twice.
  "4EF2E6670AC9B5091FE06BE0E5483EAAD6BA32D9",
  "4EF2E6670AC9B5091FE06BE0E5483EAAD6BA32D9",
## https://support.microsoft.com/en-us/help/293781/trusted-root-certificates-that-are-required-by-windows-server-2008-r2,-by-windows-7,-by-windows-server-2008,-by-windows-vista,-by-windows-server-2003,-by-windows-xp,-and-by-windows-2000
## https://gallery.technet.microsoft.com/Trusted-Root-Certificate-123665ca
  # A-Trust
  "4CAEE38931D19AE73B31AA75CA33D621290FA75E",
  "4CAEE38931D19AE73B31AA75CA33D621290FA75E",
  "CD787A3D5CBA8207082848365E9ACDE9683364D8",
  "42EFDDE6BFF35ED0BAE6ACDD204C50AE86C4F4FA",
  "2E66C9841181C08FB1DFABD4FF8D5CC72BE08F02",
# Actalis
  "F373B387065A28848AF2F34ACE192BDDC78E9CAC",
# Agencia Notarial de Certificación (ANCERT)
  "7EB1A0429BE5F428AC2B93971D7C8448A536070C",
  "6F62DEB86C85585AE42E478DB4D76DB367585AE6",
# AS Sertifitseerimiskeskuse (SK)
  "C9A8B9E755805E58E35377A725EBAFC37B27CCD7",
# Asseco Data Systems S.A. (previously Unizeto Certum)
  "6252DC40F71143A22FDE9EF7348E064251B18118",
  "07E032E020B72C3F192F0628A2593A19A70F069E",
  "D3DD483E2BBF4C05E8AF10F5FA7626CFD3DC3092",
# Athens Exchange S.A. (Athex)
  "DB2B7B434DFB7FC1CB5926EC5D9521FE350FF279",
# Atos,
  "2BB1F53E550C1DC5F1D4E6B76A464B550602AC21",
# Austrian Society for Data Protection (Arge Daten) (GlobalTrust),
  "342CD9D3062DA48C346965297F081EBC2EF68FDC",
# Autoridad de Certificacion Firmaprofesional,
  "AEC5FB3FC8E1BFC4E54F03075A9AE800B7F7B6FA",
# Autoridad de Certificación (ANF AC),
  "CEA9890D85D80753A626286CDAD78CB566D70CF2",
  "5BB59920D11B391479463ADD5100DB1D52F43AD4",
# Buypass,
  "490A7574DE870A47FE58EEF6C76BEBC60B124099",
  "DAFAF7FA6684EC068F1450BDC7C281A5BCA96457",
# Byte Computer S.A.,
  "3F0FEB17A7EF5804CFD90A77B7BB021EA69C6418",
# CA Disig a.s.,
  "8E1C74F8A620B9E58AF461FAEC2B4756511A52C6",
  "B561EBEAA4DEE4254B691A98A55747C234C7D971",
# Camerfirma,
  "6E3A55A4190C195C93843CC0DB722E313061F0B1",
  "786A74AC76AB147F9C6A3050BA9EA87EFE9ACE3C",
  "2DE16A5677BACA39E1D68C30DCB14ABE22A6179B",
  "339B6B1450249B557A01877284D9E02FC3D2D8E9",
  "4ABDEEEC950D359C89AEC752A12C5B29F6D6AA0C",
  "1139A49E8484AAF2D90D985EC4741A65DD5D94E2",
# Carillon Information Security Inc.,
  "A69E0336C4E59023FF653C71F928EB73F21C00F0",
# Certicámara S.A.,
  "CBA1C5F8B0E35EB8B94512D3F934A2E90610D336",
  "5463283B6793FF55277CEDE39098E80422F912F7",
# Certinomis,
  "2E14DAEC28F0FA1E8E389A4EABEB26C00AD383C3",
  "9D70BB01A5A4A018112EF71C01B932C534E788A8",
# certSIGN,
  "FAB7EE36972662FB2DB02AF6BF03FDE87C4B2F9B",
# China Financial Certification Authority (CFCA),
  "E2B8294B5584AB6B58C290466CAC3FB8398F8483",
  "F02B70BDE4EAE02B207377B9FD4785E4C9CC55DC",
  "EABDA240440ABBD694930A01D09764C6C2D77966",
# China Internet Network Information Center (CNNIC),
  "4F99AA93FB2BD13726A1994ACE7FF005F2935D1E",
  "8BAF4C9B1DF02A92F7DA128EB91BACF498604B6F",
# Chunghwa Telecom Corporation,
  "D99B104298594763F0B9A927B79269CB47DD158B",
  "67650DF17E8E7E5B8240A4F4564BCFE23D69C6F0",
# Cisco,
# Collegio de Registradores Mercantile (Spanish Property & Commerce Registry),
  "211165CA379FBB5ED801E31C430A62AAC109BCB4",
# Consorci Administració Oberta de Catalunya (Consorci AOC, CATCert),
  "28903A635B5280FAE6774C0B6DA7D6BAA64AF2E8",
# Cybertrust Japan / JCSI,
  "3BC49F48F8F373A09C1EBDF85BB1C365C7D811B3",
# D-TRUST,
  "6C7CCCE7D4AE515F9908CD3FF6E8C378DF6FEF97",
  "58E8ABB0361533FB80F79B1B6D29D3FF8D5F00F0",
  "96C91B0B95B4109842FAD0D82279FE60FAB91683",
# DATEV eG,
  "DA8B6567EF3F6E1EA26AB146E36CCB5728041846",
  "39410BC2303748066069A72A664DE4C743481296",
  "3DB66DFEBEB6712889E7C098B32805896B6218CC",
  "52412BD67B5A6C695282386026F0B053DD400EFC",
  "93F7F48B1261943F6A78210C52E626DFBFBBE260",
  "924AEA47F73CB690565E552CFCC6E8D63EEE4242",
  "150332A58DC591FC42D4C873FF9F1F0F81D597C9",
  "AB9D58C03F54B1DAE3F7C2D4C6C1EC3694559C37",
  "27EED22AFD58A2C64A855E3680AF898BF36CE503",
# Deutscher Sparkassen Verlag GmbH (S-TRUST, DSV-Gruppe),
  "BEB5A995746B9EDF738B56E6DF437A77BE106B81",
  "1B3D1114EA7A0F9558544195BF6B2582AB40CE9A",
  "8025EFF46E70C8D472246584FE403B8A8D6ADBF5",
# Dhimyotis / Certigna,
  "B12E13634586A46F1AB2606837582DC4ACFD9497",
  "2D0D5214FF9EAD9924017420476E6C852727F543",
# DigiCert,
# Digidentity BV **,
  "F138A330A4EA986BEB520BB11035876EFB9D7F1C",
# DocuSign (OpenTrust/Keynectis),
# e-tugra,
  "51C6E70849066EF392D45CA00D6DA3628FC35239",
# Echoworx,
  "CB658264EA8CDA186E1752FB52C397367EA387BE",
# EDICOM,
  "E0B4322EB2F6A568B654538448184A5036874384",
  "559BBA7B0FFE80D6D3829B1FD07AA4D322194790",
# Global Digital Cybersecurity Authority Co., Ltd. (Formerly Guang Dong Certificate Authority (GDCA)),
  "0F36385B811A25C39B314E83CAE9346670CC74B4",
# GlobalSign,
# GoDaddy,
# Google Trust Services (GTS),
# Government of Australia,
  "84429D9FE2E73A0DC8AA0AE0A902F2749933FE02",
  "A9CAFE9DFD67F4145AD397D0E2F3050D198DE6EE",
# Government of Brazil, Instituto Nacional de Tecnologia da Informação (ITI),
  "705D2B4565C7047A540694A79AF7ABB842BDC161",
  "A9822E6C6933C63C148C2DCAA44A5CF1AAD2C42E",
# Government of Finland, Population Register Centre’s (Väestörekisterikeskus, VRK),
  "FAA7D9FB31B746F200A85E65797613D816E063B5",
# Government of France (ANSSI, DCSSI),
  "60D68974B5C2659E8A0FC1887C88D246691B182C",
# Government of Hong Kong (SAR), Hongkong Post, Certizen,
  "D6DAA8208D09D2154D24B52FCB346EB258B28A58",
# Government of Hungary,
  "FFB7E08F66E1D0C2582F0245C4970292A46E8803",
# Government of India, Ministry of Communications & Information Technology, Controller of Certifying Authorities (CCA),
  "A2B86B5A68D92819D9CE5DD6D7969A4968E11991",
  "3BC6DCE00307BD676041EBD85970C62F8FDA5109",
# Government of Japan, Ministry of Internal Affairs and Communications,
  "F00FC37D6A1C9261FB6BC1C218498C5AA4DC51FB",
# Government of Korea, Ministry of the Interior,
  "7612ED9E49B365B4DAD3120C01E603748DAE8CF0",
# Government of Latvia, Latvian State Radio & Television Centre (LVRTC),
  "C9321DE6B5A82666CF6971A18A56F2D3A8675602",
  "086418E906CEE89C2353B6E27FBD9E7439F76316",
# Government of Lithuania, Registru Centras,
  "971D3486FC1E8E6315F7C6F2E12967C724342214",
# Government of Portugal, Sistema de Certificação Electrónica do Estado (SCEE) / Electronic Certification System of the State,
  "3913853E45C439A2DA718CDFB6F3E033E04FEE71",
# Government of Saudi Arabia, NCDC,
  "8351509B7DF8CFE87BAE62AEB9B03A52F4E62C79",
# Government of Slovenia,
  "3A4979B40FA841488200B582FBEEB63AAB9919AE",
# Government of South Africa, Post Office Trust Centre,
  "E45501608AA1EF89E27B8CD3C3B34C03B038E6D7",
  "38DD7659C735100B00A237E491B7BC0FFCD2316C",
  "20A8F5FFC43AF4A9BC89881EBF9920FF91E9FD0A",
# Government of Spain, Autoritat de Certificació de la Comunitat Valenciana (ACCV),
  "93057A8815C64FCE882FFA9116522878BC536417",
# Government of Spain, Dirección General de la Policía – Ministerio del Interior – España.,
  "B38FECEC0B148AA686C3D00F01ECC8848E8085EB",
# Government of Spain, Fábrica Nacional de Moneda y Timbre (FNMT),
  "B865130BEDCA38D27F69929420770BED86EFBC10",
  "43F9B110D5BAFD48225231B0D0082B372FEF9A54",
# Government of Spain, Ministerio de Trabajo e Inmigración (MTIN),
  "6AD23B9DC48E375F859AD9CAB585325C23894071",
# Government of Sweden (Försäkringskassan) **,
  "32F442093B36D7031B75CA4DADDCB327FAA02B9C",
  "11E19BBC747B1AED0DB833C94CAC6C3F85BDEBDB",
  "746F88F9AC163C53009EEF920C4067756A15717E",
# Government of Taiwan, Government Root Certification Authority (GRCA),
  "F48B11BFDEABBE94542071E641DE6BBE882B40B9",
  "B091AA913847F313D727BCEFC8179F086F3A8C0F",
# Government of The Netherlands, PKIoverheid (Logius),
  "D8EB6B41519259E0F3E78500C03DB68897C9EEFC",
  "76E27EC14FDB82C1C0A675B505BE3D29B4EDDBBB",
  "59AF82799186C7B47507CBCF035746EB04DDB716",
# Government of Tunisia, Agence National de Certification Electronique / National Digital Certification Agency (ANCE/NDCA),
  "9638633C9056AE8814A065D23BDC60A0EE702FA7",
# Government of Turkey, Kamu Sertifikasyon Merkezi (Kamu SM),
  "3143649BECCE27ECED3A3F0B8F0DE4E891DDEECA",
  "1B4B396126276B6491A2686DD70243212D1F1D96",
# Government of Uruguay, Agency for E-Government and Information Society (AGESIC),
  "7A1CDDE3D2197E7137433D3F99C0B369F706C749",
# Government of Venezuela, Superintendencia de Servicios de Certificación Electrónica (SUSCERTE),
  "398EBE9C0F46C079C3C7AFE07A2FDD9FAE5F8A5C",
  "DD83C519D43481FAD4C22C03D702FE9F3B22F517",
# Halcom D.D.,
  "0409565B77DA582E6495AC0060A72354E64B0192",
  "7FBB6ACD7E0AB438DAAF6FD50210D007C6C0829C",
  "535B001672ABBF7B6CC25405AE4D24FE033FD1CC",
# HARICA,
  "9FF1718D92D59AF37D7497B4BC6F84680BBAB666",
  "FE45659B79035B98A161B5512EACDA580948224D",
  "010C0695A6981914FFBF5FC6B0B695EA29E912A6",
# I.CA První Certifikační Autorita, A.S.,
  "AB16DD144ECDC0FC4BAAB62ECF0408896FDE52B7",
  "64902AD7277AF3E32CD8CC1DC79DE1FD7F8069EA",
  "9B0959898154081BF6A90E9B9E58A4690C9BA104",
  "D2441AA8C203AECAA96E501F124D52B68FE4C375",
  "90DECE77F8C825340E62EBD635E1BE20CF7327DD",
# IdenTrust (Let's Encrypt),
# Image-X Enterprises Inc,
  "9F8DE799CF8764ED2466990564041B194919EDE8",
# Inera AB (SITHS),
  "585F7875BEE7433EB079EAAB7D05BB0F7AF2BCCC",
# Izenpe S.A.,
  "4A3F8D6BDC0E1ECFCD72E377DEF2D7FF92C19BC7",
  "2F783D255218A74A653971B52CA29C45156FE919",
# Japan Local Authority Information Systems (J-LIS),
  "6F3884568E99C8C6AC0E5DDE2DB202DD002E3663",
# Korea Information Security Agency (KISA),
  "027268293E5F5D17AAA4B3C3E6361E1F92575EAA",
# Krajowa Izba Rozliczeniowa S.A. (KIR),
  "D3EEFBCBBCF49867838626E23BB59CA01E305DB7",
  "E252FA953FEDDB2460BD6E28F39CCCCF5EB33FDE",
# LAWtrust,
  "335A7FF00927CF2DF278E2C9192F7A4D5534F80C",
# LuxTrust,
  "1E0E56190AD18B2598B20444FF668A0417995F3F",
  "C93C34EA90D9130C0F03004B98BD8B3570915611",
# Macao Post and Telecommunications eSignTrust Certification Authority,
  "06143151E02B45DDBADD5D8E56530DAAE328CF90",
# Microsec e-Szignó CA,
  "89DF74FE5CF40F4A80F9E3377D54DA91E101318E",
# Microsoft Corporation,
# MULTICERT,
  "46AF7A31B599460D469D6041145B13651DF9170A",
# NetLock Ltd.,
  "06083F593F15A104A069A46BA903D006B7970991",
  "ACED5F6553FD25CE015F1F7A483B6A749F6178C6",
  "016897E1A0B8F2C3B134665C20A727B7A158E28F",
  "EC93DE083C93D933A986B3D5CDE25ACB2FEECF8E",
# Netrust,
  "55C86F7414AC8BDD6814F4D86AF15F3710E104D0",
# Nets DanID,
  "5CFB1F5DB732E4084C0DD4978574E0CBC093BEB3",
# NLB Nova Ljubljanska Banka d.d. Ljubljana,
  "0456F23D1E9C43AECB0D807F1C0647551A05F456",
# Notarius,
  "1F3F1486B531882802E87B624D420295A0FC721A",
# Open Access Technology International, Inc. (OATI),
  "4B6BD2D3884E46C80CE2B962BC598CD9D5D84013",
# Personal I.D. LTD,
  "4394CE3126FF1A224CDD4DEEB4F4EC1DA368EF6A",
# Post of Slovenia,
  "D6BF7994F42BE5FA29DA0BD7587B591F47A44F22",
  "B1EAC3E5B82476E9D50B1EC67D2CC11E12E0B491",
# PostSignum operated by Ceska posta s.p. (Czech Post),
  "A0F8DB3F0BF417693B282EB74A6AD86DF9D448A3",
# QuoVadis,
# Red Abogacía,
  "D496592B305707386CC5F3CDB259AE66D7661FCA",
  "7F8A77836BDC6D068F8B0737FCC5725413068CA4",
# SECOM Trust Systems Co. Ltd.,
  "36B12B49F9819ED74C9EBC380FC6568F5DACB2F7",
  "5F3B8CF2F810B37D78B4CEEC1919C37334B9C774",
  "B80E26A9BFD2B23BC0EF46C9BAC7BBF61D0D4141",
  "FEB8C432DCF9769ACEAE3DD8908FFD288665647D",
  "C303C8227492E561A29C5F79912B1E441391303A",
# Shanghai Electronic Certification Authority Co., Ltd. (SHECA),
  "0B972C9EA6E7CC58D93B20BF71EC412E7209FABF",
  "8250BED5A214433A66377CBC10EF83F669DA3A67",
  "28F97816197AFF182518AA44FEC1A0CE5CB64C8A",
  "A3A1B06F2461234AE336A5C237FCA6FFDDF0D73A",
# Skaitmeninio sertifikavimo centras (SSC),
  "23E833233E7D0CC92B7C4279AC19C2F474D604CA",
  "3E84D3BCC544C0F6FA19435C851F3F2FCBA8E814",
  "5A5A4DAF7861267C4B1F1E67586BAE6ED4FEB93F",
  "C860A318FCF5B7130B1007AD7F614A40FFFF185F",
# SSL.com,
  "4CDD51A3D1F5203214B0C6C532230391C746426D",
  "1CB7EDE176BCDFEF0C866F46FBF980E901E5CE35",
  "C3197C3924E654AF1BC4AB20957AE2C30E13026A",
  "B7AB3308D1EA4477BA1480125A6FBDA936490CBB",
# Start Commercial (StartCom) Ltd.,
  "3E2BF7F2031B96F38CE6C4D8A85D3E2D58476A0F",
  "31F1FD68226320EEC63B3F9DEA4A3E537C7C3917",
# Swiss BIT, Swiss Federal Office of Information Technology, Systems and Telecommunication (FOITT),
  "A1585187156586CEF9C454E22AB15C58745607B4",
  "C7F7CBE2023666F986025D4A3E313F29EB0C5B38",
  "CCEAE32445CD4218DD188EADCEB3133C7FB340AD",
# Swisscom (Switzerland) Ltd,
  "5F3AFC0A8B64F686673474DF7EA9A2FEF9FA7A51",
  "77474FC630E40F4C47643F84BAB8C6954A8A41EC",
  "E7A19029D3D552DC0D0FC692D3EA880D152E1A6B",
# SwissSign AG,
  "D8C5388AB7301B1B6ED47AE645253A6F9F1A2761",
  "0B7199A1C7F3ADDF7BA7EAB8EB574AE80D60DDDE",
  "56E0FAC03B8F18235518E5D311CAE8C24331AB66",
  "A1E7C600AA4170E5B74BC94F9B9703EDC261B4B9",
  "9BAAE59F56EE21CB435ABE2593DFA7F040D11DCB",
  "8D08FC43C0770CA84F4DCCB2D41A5D956D786DC4",
# Symantec,
# Symantec / GeoTrust,
# Symantec / Thawte,
# Symantec / VeriSign,
# T-Systems International GmbH (Deutsche Telekom),
  "85A408C09C193E5D51587DCDD61330FD8CDE37BF",
  "590D2D7D884F402E617EA562321765CF17D894E9",
  "55A6723ECBF2ECCDC3237470199D2ABE11E381D1",
# Taiwan-CA Inc. (TWCA),
  "9CBB4853F6A4F6D352A4E83252556013F5ADAF65",
  "CF9E876DD3EBFC422697A3B5A37AA076A9062348",
# Telekom Applied Business Malaysia (TMCA),
  "9957C53FC59FB8E739F7A4B7A70E9B8E659F208C",
# Telia Company (formerly TeliaSonera),
  "0747220199CE74B97CB03D79B264A2C855E933FF",
  "37F76DE6077C90C5B13E931AB74110B4F2E49A27",
  "4313BB96F1D5869BC14E6A92F6CFF63469878237",
# Thailand National Root Certificate Authority (Electronic Transactions Development Agency),
  "66F2DCFB3F814DDEE9B3206F11DEFE1BFBDFE132",
# The Uruguayan Post, “El Correo Uruguayo,
  "F9DD19266B2043F1FE4B3DCB0190AFF11F31A69D",
# TrustCor Systems,
  "58D1DF9595676B63C0F05B1C174D8B840BC878BD",
  "FFBDCDE782C8435E3C6F26865CCAA83A455BC30A",
  "B8BE6DCB56F155B963D412CA4E0634C794B21CC0",
# Trustis,
  "3BC0380B33C3F6A60C86152293D9DFF54B81C004",
# Trustwave,
# TurkTrust,
  "F17F6FB631DC99E3A3C87FFE1CF1811088D96033",
  "C418F64D46D1DF003D2730137243A91211C675FB",
  "8A5C8CEEA503E60556BAD81BD4F6C9B0EDE52FE0",
# U.S. Federal Public Key Infrastructure (US FPKI),
  "CB44A097857C45FA187ED952086CB9841F2D51B5",
  "905F942FD9F28F679B378180FD4F846347F645C1",
# Visa,
# Web.com,
  "71899A67BF33AF31BEFDC071F8F733B183856332",
  "80F95B741C38399495C34F20C23E7336314D3C6B",
  "8E928C0FC27BB7ABA34E6BC0CA1250CB57B60F84",
# Wells Fargo Bank N.A.,
  "B42C86C957FD39200C45BBE376C08CD0F4D586DB",
# WISeKey,
  "5922A1E15AEA163521F898396A4646B0441B0FA9",
  "0FF9407618D3D76A4B98F0A8359E0CFD27ACCCED",
# WoSign CA Limited,
  "D27AD2BEED94C0A13CC72521EA5D71BE8119F32B",
  "B94294BF91EA8FB64BE61097C7FB001359B676CB",
  "FBEDDC9065B7272037BC550C9C56DEBBF27894E1",
  "1632478D89F9213A92008563F5A4A7D312408AD6"
  )



function Remove-CertificateArray ($StoreName = "My", $StoreLocation = "CurrentUser", [Object[]] $HashArrayToRemove)
{
    $discoveredhashes = @()
    $deletedhashes = @()

    $store = New-Object System.Security.Cryptography.X509Certificates.X509Store($StoreName,$StoreLocation)
    if (-not $?) { "`nERROR: Failed to access the $StoreLocation\$StoreName certificate store!" ; return }

    $store.open("MaxAllowed")
    if (-not $?) { "`nERROR: Failed to open the $StoreLocation\$StoreName certificate store with MaxAllowed privileges!" ; return }

    $store.certificates |
        foreach `
        {
            if ($HashArrayToRemove -contains $_.thumbprint)
            {
                $discoveredhashes += $_.thumbprint
                $store.remove($_)
                if ($?){ $deletedhashes += $_.thumbprint }
            }
        }
    $store.close()

    "`n*For the $StoreLocation in the $StoreName certificate store, $($discoveredhashes.count) matching certificates were found and $($deletedhashes.count) certificates were removed.`n"
    "`nDiscovered in $StoreLocation\$StoreName :`n"
    $discoveredhashes | foreach { $_ }
    "`n`nRemoved from $StoreLocation\$StoreName :`n"
    $deletedhashes | foreach { $_ }
    "`n"
}


# Capture output for reporting and writing to the Application event log.
$output = ""


# Look for the unwanted certs in a variety of locations, some of which will be redundant, but
# sometimes the script will be run as a user, sometimes as the computer, so better safe than
# sorry.  Btw, the Root store is "Trusted Root Certification Authorities" and AuthRoot
# is "Third-Party Trusted Root Certification Authorities."

$output += Remove-CertificateArray -StoreName "Root" -StoreLocation "CurrentUser" -HashArrayToRemove $BadCerts
$output += Remove-CertificateArray -StoreName "AuthRoot" -StoreLocation "CurrentUser" -HashArrayToRemove $BadCerts
$output += Remove-CertificateArray -StoreName "Root" -StoreLocation "LocalMachine" -HashArrayToRemove $BadCerts
$output += Remove-CertificateArray -StoreName "AuthRootRoot" -StoreLocation "LocalMachine" -HashArrayToRemove $BadCerts


# Write the output to the local Application event log.
new-eventlog -LogName Application -Source RemoveRootCertificate -ErrorAction SilentlyContinue
write-eventlog -logname Application -source RemoveRootCertificate -eventID 9019 -message $output -EntryType Information


# Display report if desired.
"`n" + $output
