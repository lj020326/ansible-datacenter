---

- name: webmin | Install webmin mandatory dependencies
  package:
    state: present
    name:
      - apt-transport-https
      - libapache2-mod-fcgid
      - webalizer
#          - webmin-virtualmin-git

- name: webmin | Add Optional channel (Debian)
  template:
    src: webmin.debian.repo.j2
    dest: /etc/apt/sources.list.d/webmin.repo.list
    mode: "0644"

- name: webmin | Addkey webmin
  apt_key:
    url: "{{ webmin_repo_key_url }}"
    state: present

## ref: https://www.redpill-linpro.com/sysadvent/2017/12/24/ansible-system-updates.html
## ref: https://www.cyberciti.biz/faq/ansible-apt-update-all-packages-on-ubuntu-debian-linux/#:~:text=Upgrading%20all%20apt%20packages%20using%20Ansible&text=dist%20force_apt_get%3Dyes-,Where%2C,apt%2Dget%20instead%20of%20aptitude.
- name: webmin | Update apt-get repo and cache
  apt:
    update_cache: yes
    force_apt_get: yes

- name: webmin | Install webmin package
  package:
    name: webmin
    state: present
#    state: latest
#    update_cache: yes
#  changed_when: no

#- name: webmin | Remove duplicate entry.
##  when: ( ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu' )
#  when: ansible_os_family == 'Debian'
#  file: name=/etc/apt/sources.list.d/{{ item }} state=absent
#  become: true
#  with_items: webmin_repo_files
