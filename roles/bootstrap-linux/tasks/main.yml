---

#- name: "Setup cloud-init"
#  include_role:
#    name: bootstrap-cloud-init
#  tags:
#    - bootstrap-linux-core
#    - bootstrap-linux-nocerts
#    - bootstrap-cloudinit

- name: "Bootstrap linux users"
  include_role:
    name: bootstrap-linux-user
  tags:
    - bootstrap-linux-core
    - bootstrap-linux-nocerts
    - bootstrap-linux-user
    - bootstrap-user

- name: "Bootstrap linux packages"
  include_role:
    name: bootstrap-linux-package
  tags:
    - bootstrap-linux-core
    - bootstrap-linux-nocerts
    - bootstrap-linux-package
    - bootstrap-package

- name: "Bootstrap linux mounts"
  include_role:
    name: bootstrap-linux-mount
  tags:
    - bootstrap-linux-core
    - bootstrap-linux-nocerts
    - bootstrap-linux-mount
    - bootstrap-mount

- name: "Bootstrap linux core features (environment, dns, hostname, mounts, backups, timezone, journald, motd, etc)"
  include_role:
    name: bootstrap-linux-core
  tags:
    - bootstrap-linux-core
    - bootstrap-linux-nocerts

- name: "Setup vmware-tools"
  include_role:
    name: vmware-tools
  when: "'vm_template' in group_names or 'vmware_vm' in group_names"
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-vmtools

- name: "Setup bootstrap-ntp"
  include_role:
    name: bootstrap-ntp
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-ntp

- name: "Install/Setup linux firewalld"
  include_role:
    name: bootstrap-linux-firewalld
  vars:
    firewalld_action: install
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-firewalld

- name: "Bootstrap postfix"
  include_role:
    name: bootstrap-postfix
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-postfix

- name: "Bootstrap pip"
  include_role:
    name: bootstrap-pip
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-pip

- name: "Bootstrap java"
  include_role:
    name: bootstrap-java
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-java

## ref: ## https://www.ssh.com/ssh/sshd_config/
- name: "Setup sshd"
  include_role:
    name: bootstrap-sshd
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-sshd

- name: "Setup ldap-client"
  include_role:
    name: ldap-client
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-ldap-client

- name: "Setup logrotate"
  include_role:
    name: ansible-logrotate
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-logrotate

- name: "Bootstrap nfs service"
  include_role:
    name: bootstrap-nfs-service
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-nfs

- name: "Setup samba-client"
  include_role:
    name: samba-client
  when: "'samba_client' in group_names"
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-samba
    - samba-client

- name: "Setup webmin"
  include_role:
    name: webmin
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-webmin

- name: "Setup docker"
  include_role:
    name: bootstrap-linux-docker
  tags:
    - bootstrap-linux-docker

- name: "Setup bootstrap-linux-docker-config"
  include_role:
    name: bootstrap-linux-docker-config
  tags:
    - bootstrap-linux-docker
    - bootstrap-linux-docker-config
    - docker-config

- name: "Setup network"
  include_role:
    name: bootstrap-linux-networking
  when: "'vm_template' not in group_names"
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-network

#- name: "Setup bootstrap-linux-caroot"
##  when: "'compute_baremetal' in group_names"
#  include_role:
#    name: bootstrap-linux-caroot
#  tags:
#    - bootstrap-linux-core
#    - bootstrap-caroot

- name: "Setup ansible-role-stepca"
  include_role:
    name: ansible-role-stepca
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-stepcli

- name: "Run deploy-cacerts"
#  when: "'vm_template' not in group_names"
  include_role:
    name: deploy-cacerts

- name: "Setup ansible-harden-linux"
  include_role:
    name: ansible-harden-linux
  tags:
    - bootstrap-linux-nocerts
    - bootstrap-secure

