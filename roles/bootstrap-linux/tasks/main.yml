---

#- name: "Setup cloud-init"
#  include_role:
#    name: bootstrap-cloud-init
#  tags: [ bootstrap-linux-nocerts, bootstrap-cloudinit ]

- name: "Setup bootstrap-linux-core"
  include_role:
    name: bootstrap-linux-core
  tags: [ bootstrap-linux-core, bootstrap-linux-nocerts, bootstrap-configs, common-configs ]

- name: "Setup vmware-tools"
  include_role:
    name: vmware-tools
  when: "'vm_template' in group_names or 'vmware_vm' in group_names"
  tags: [ bootstrap-linux-nocerts, bootstrap-vmtools ]

- name: "Setup geerlingguy.ntp"
  include_role:
#    name: geerlingguy.ntp
    name: ansible-role-ntp
  tags: [ bootstrap-linux-nocerts, bootstrap-ntp ]

- name: "Install/Setup linux firewalld"
  include_role:
    name: bootstrap-linux-firewall
  vars:
    firewalld_action: install
  tags: [ bootstrap-linux-nocerts, bootstrap-firewalld ]

- name: "Setup ansible-postfix"
  include_role:
    name: bootstrap-postfix
  tags: [ bootstrap-linux-nocerts, bootstrap-postfix ]

- name: "Setup geerlingguy.pip"
  include_role:
    name: geerlingguy.pip
  tags: [ bootstrap-linux-nocerts, bootstrap-pip ]

- name: "Setup geerlingguy.java"
  include_role:
    name: geerlingguy.java
  tags: [ bootstrap-linux-nocerts, bootstrap-java ]

## ref: ## https://www.ssh.com/ssh/sshd_config/
- name: "Setup sshd"
  include_role:
    name: bootstrap-sshd
  tags: [ bootstrap-linux-nocerts, bootstrap-sshd ]

- name: "Setup ldap-client"
  include_role:
    name: ldap-client
  tags: [ bootstrap-linux-nocerts, bootstrap-ldap-client ]

- name: "Setup logrotate"
  include_role:
    name: ansible-logrotate
  tags: [ bootstrap-linux-nocerts, bootstrap-logrotate ]

- name: "Setup nfs-service"
  include_role:
    name: nfs-service
  tags: [ bootstrap-linux-nocerts, bootstrap-nfs ]

- name: "Setup samba-client"
  include_role:
    name: samba-client
  when: "'samba_client' in group_names"
  tags: [ bootstrap-linux-nocerts, bootstrap-samba, samba-client ]

- name: "Setup webmin"
  include_role:
    name: webmin
  tags: [ bootstrap-linux-nocerts, bootstrap-webmin ]

- name: "Setup docker"
  include_role:
    name: bootstrap-linux-docker
  tags: [ bootstrap-linux-docker ]

- name: "Setup bootstrap-linux-docker-config"
  include_role:
    name: bootstrap-linux-docker-config
  tags: [ bootstrap-linux-docker, bootstrap-linux-docker-config, docker-config ]

- name: "Setup network"
  include_role:
    name: network
  when: "'vm_template' not in group_names"
  tags: [ bootstrap-linux-nocerts, bootstrap-network ]

#- name: "Setup bootstrap-linux-caroot"
##  when: "'compute_baremetal' in group_names"
#  include_role:
#    name: bootstrap-linux-caroot
#  tags: [ bootstrap-linux-core, bootstrap-caroot ]

- name: "Setup ansible-role-stepca"
  include_role:
    name: ansible-role-stepca
  tags: [ bootstrap-linux-nocerts, bootstrap-stepcli ]

- name: "Run deploy-cacerts"
#  when: "'vm_template' not in group_names"
  include_role:
    name: deploy-cacerts

- name: "Setup ansible-harden-linux"
  include_role:
    name: ansible-harden-linux
  tags: [ bootstrap-linux-nocerts, bootstrap-secure ]

