---

#- name: "Setup mrlesmithjr.ansible-cloud-init"
#  include_role:
#    name: mrlesmithjr.ansible-cloud-init
#  tags: [ bootstrap-linux-nocerts, bootstrap-cloudinit ]

- name: "Setup vmware-tools"
  include_role:
    name: vmware-tools
#  when: inventory_hostname in groups['vm_template'] or inventory_hostname in groups['vmware_vm']
  when: "'vm_template' in group_names or 'vmware_vm' in group_names"
  tags: [ bootstrap-linux-nocerts, bootstrap-vmtools ]

- name: "Setup geerlingguy.ntp"
  include_role:
    name: geerlingguy.ntp
  tags: [ bootstrap-linux-nocerts, bootstrap-ntp ]

- name: "Setup ansible-firewalld"
  include_role:
    name: ansible-firewalld
  tags: [ bootstrap-linux-nocerts, bootstrap-firewalld ]

- name: "Setup firewall-config"
  include_role:
    name: firewall-config
  tags: [ bootstrap-linux-nocerts, bootstrap-firewalld ]

- name: "Setup ansible-postfix"
  include_role:
    name: ansible-postfix
  tags: [ bootstrap-linux-nocerts, bootstrap-postfix, bootstrap-mail ]

- name: "Setup geerlingguy.pip"
  include_role:
    name: geerlingguy.pip
  tags: [ bootstrap-linux-nocerts, bootstrap-pip ]

- name: "Setup geerlingguy.java"
  include_role:
    name: geerlingguy.java
  tags: [ bootstrap-linux-nocerts, bootstrap-java ]

- name: "Setup bootstrap-linux-core"
  include_role:
    name: bootstrap-linux-core
  tags: [ bootstrap-linux-core, bootstrap-linux-nocerts, bootstrap-configs, common-configs ]

## ref: ## https://www.ssh.com/ssh/sshd_config/
- name: "Setup willshersystems.sshd"
  include_role:
    name: willshersystems.sshd
  tags: [ bootstrap-linux-nocerts, bootstrap-sshd ]

- name: "Setup ldap-client"
  include_role:
    name: ldap-client
  tags: [ bootstrap-linux-nocerts, bootstrap-ldap-client ]

- name: "Setup users"
  include_role:
    name: bootstrap-user
  tags: [ bootstrap-linux-nocerts, bootstrap-linux-user ]

- name: "Setup nfs-service"
  include_role:
    name: nfs-service
  tags: [ bootstrap-linux-nocerts, bootstrap-nfs ]

- name: "Setup samba-client"
  include_role:
    name: samba-client
#  when: inventory_hostname in groups['samba_client']|d([])
#  when: inventory_hostname in groups['samba_client']
  when: "'samba_client' in group_names"
  tags: [ bootstrap-linux-nocerts, bootstrap-samba, samba-client ]

- name: "Setup webmin"
  include_role:
    name: webmin
  tags: [ bootstrap-linux-nocerts, bootstrap-webmin ]

- name: "Setup avinetworks.docker"
  include_role:
    name: avinetworks.docker
  tags: [ bootstrap-linux-docker ]

- name: "Setup bootstrap-docker-config"
  include_role:
    name: docker-config
  tags: [ bootstrap-linux-docker, bootstrap-docker-config, docker-config ]

- name: "Setup network"
  include_role:
    name: network
#  when: inventory_hostname not in groups['vm_template']|d([])
  when: "'vm_template' not in group_names"
  tags: [ bootstrap-linux-nocerts, bootstrap-network ]

#- name: "Setup bootstrap-linux-caroot"
##  when: "'server_baremetal' in group_names"
#  include_role:
#    name: bootstrap-linux-caroot
#  tags: [ bootstrap-linux-core, bootstrap-caroot ]

- name: "Setup ansible-role-stepca"
  include_role:
    name: ansible-role-stepca
  tags: [ bootstrap-linux-nocerts, bootstrap-stepcli ]

- name: "Run deploy-cacertss"
#  when: inventory_hostname not in groups['vm_template']
#  when: "'server_vm' in group_names"
  include_role:
    name: deploy-cacert

- name: "Setup ansible-os-hardening"
  include_role:
    name: ansible-os-hardening
  tags: [ bootstrap-linux-nocerts, bootstrap-secure ]

