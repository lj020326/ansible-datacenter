---

__docker_stack__jenkins_jcac__environment: "{{ docker_stack__jenkins_jcac__environment | d(docker_stack__environment) }}"

#__docker_stack__jenkins_jcac__ansible_tool_python_interpreter_default: "python3"
__docker_stack__jenkins_jcac__ansible_tool_python_interpreter_default: "python3.8"
__docker_stack__jenkins_jcac__ansible_tool_python_interpreter: "{{
  docker_stack__jenkins_jcac__ansible_tool_python_interpreter
  | d(__docker_stack__jenkins_jcac__ansible_tool_python_interpreter_default) }}"

__docker_stack__jenkins_jcac__stack_dir: "{{ docker_stack__dir | d('/home/user/docker-dirs') }}"
__docker_stack__jenkins_jcac__base_dir_default: "{{ __docker_stack__jenkins_jcac__stack_dir }}/jenkins_jcac"
__docker_stack__jenkins_jcac__base_dir: "{{ docker_stack__jenkins_jcac__dir | d(__docker_stack__jenkins_jcac__base_dir_default) }}"

__docker_stack__jenkins_jcac__traefik_host_default: "jenkins.example.int"
__docker_stack__jenkins_jcac__host: "{{ docker_stack__jenkins_jcac__host
  | d(docker_stack__jenkins_host)
  | d(docker_stack__traefik_host)
  | d(__docker_stack__jenkins_jcac__traefik_host_default) }}"

__docker_stack__jenkins_jcac__agent_base_dir_default: "{{ __docker_stack__jenkins_jcac__stack_dir }}/jenkins_agent"
__docker_stack__jenkins_jcac__agent_base_dir: "{{ docker_stack__jenkins_jcac__agent_base_dir
  | d(__docker_stack__jenkins_jcac__agent_base_dir_default) }}"

__docker_stack__jenkins_jcac__http: "{{ docker_stack__jenkins_jcac__http | d('10180') }}"

## ref: https://www.jenkins.io/blog/2020/05/11/docker-windows-agents/
## ref: https://support.cloudbees.com/hc/en-us/articles/115001771692-How-to-Create-Permanent-Agents-with-Docker
## ref: https://github.com/jenkinsci/docker-inbound-agent
## ref: https://wiki.tds.tieto.com/display/TDSKB/Executing+Jenkins+jobs+when+only+one+way+network+connection+exists
__docker_stack__jenkins_jcac__agent_port: "{{ docker_stack__jenkins_jcac__agent_port | d('9000') }}"
__docker_stack__jenkins_jcac__agent_tcp_port: "{{ docker_stack__jenkins_jcac__tcp_port | d('9000') }}"
__docker_stack__jenkins_jcac__agent_ssh_port: "{{ docker_stack__jenkins_jcac__ssh_port | d('4444') }}"

__docker_stack__jenkins_jcac__mgr_pwd_secret: "{{ docker_stack__jenkins_jcac__mgr_pwd_secret | d('00000000000000000000000') }}"

__docker_stack__jenkins_jcac__agent_username: "{{ docker_stack__jenkins_jcac__agent_username | d('00000000000000000000000') }}"
__docker_stack__jenkins_jcac__agent_password: "{{ docker_stack__jenkins_jcac__agent_password | d('00000000000000000000000') }}"

__docker_stack__jenkins_jcac__agent_swarm_mode: yes

## ref: https://www.jenkins.io/blog/2020/05/11/docker-windows-agents/
#__docker_stack__jenkins_jcac__image_default: "jenkins/jenkins:lts"
#__docker_stack__jenkins_jcac__image_default: "{{ docker_stack__registry_endpoint }}/jenkins-docker-jcac:latest"
__docker_stack__jenkins_jcac__image_default: "{{ docker_stack__registry_endpoint }}/docker-jenkins-jcac:latest"
__docker_stack__jenkins_jcac__image: "{{ docker_stack__jenkins_jcac__image | d(__docker_stack__jenkins_jcac__image_default) }}"

__docker_stack__jenkins_jcac__agent_image_default: "{{ docker_stack__registry_endpoint }}/jenkins-docker-cicd-agent:latest"
__docker_stack__jenkins_jcac__agent_image: "{{ docker_stack__jenkins_agent_image | d(__docker_stack__jenkins_jcac__agent_image_default) }}"

__docker_stack__jenkins_jcac__swarm_agent_image_default: "{{ docker_stack__registry_endpoint }}/jenkins-swarm-agent:latest"
__docker_stack__jenkins_jcac__swarm_agent_image: "{{ docker_stack__jenkins_swarm_agent_image
  | d(__docker_stack__jenkins_jcac__swarm_agent_image_default) }}"

__docker_stack__jenkins_jcac__ldap_host: "{{ docker_stack__jenkins_jcac__ldap_host | d(docker_stack__ldap_host)}}"
__docker_stack__jenkins_jcac__ldap_uri: "{{ docker_stack__jenkins_jcac__ldap_uri | d(docker_stack__ldap_uri) | d(docker_stack__ldap_host) }}"
__docker_stack__jenkins_jcac__ldap_base_dn: "{{ docker_stack__jenkins_jcac__ldap_base_dn | d(docker_stack__ldap_base_dn)}}"

__docker_stack__jenkins_jcac__ldap_bind_user_dn_default: "cn=readonly,{{ __docker_stack__jenkins_jcac__ldap_base_dn
  | d(docker_stack__ldap_user_base_dn) }}"
__docker_stack__jenkins_jcac__ldap_bind_user_dn: "{{ docker_stack__jenkins_jcac__ldap_bind_user_dn
  | d(docker_stack__ldap_bind_user_dn) | d(__docker_stack__jenkins_jcac__ldap_bind_user_dn_default) }}"
__docker_stack__jenkins_jcac__ldap_bind_user_password: "{{ docker_stack__jenkins_jcac__ldap_bind_user_password
  | d(docker_stack__ldap_bind_user_password) }}"

#__docker_stack__jenkins_jcac__data_dir_default: /export/data/jenkins/osimages
#__docker_stack__jenkins_jcac__data_dir_default: /export/data/jenkins
__docker_stack__jenkins_jcac__data_dir_default: /data/datacenter/jenkins
__docker_stack__jenkins_jcac__data_dir: "{{ docker_stack__jenkins_data_dir | d(__docker_stack__jenkins_jcac__data_dir_default) }}"

#__docker_stack__jenkins_jcac__pipeline_lib_repo_default: "https://gitea.example.int/infra/pipeline-automation-lib.git"
__docker_stack__jenkins_jcac__pipeline_lib_repo_default: "ssh://git@bitbucket.alsac.stjude.org:7999/aap/pipeline-automation-lib.git"
__docker_stack__jenkins_jcac__pipeline_lib_repo: "{{ docker_stack__jenkins_jcac__pipeline_lib_repo
  | d(__docker_stack__jenkins_jcac__pipeline_lib_repo_default) }}"

__docker_stack__jenkins_jcac__vmware_data_dir_default: /data/datacenter/vmware
__docker_stack__jenkins_jcac__vmware_data_dir: "{{ docker_stack__jenkins_jcac__vmware_data_dir | d(__docker_stack__jenkins_jcac__vmware_data_dir_default) }}"

__docker_stack__jenkins_jcac__config_dirs:
  - path: "{{ __docker_stack__jenkins_jcac__base_dir }}"
  - path: "{{ __docker_stack__jenkins_jcac__base_dir }}/jenkins_home"
  - path: "{{ __docker_stack__jenkins_jcac__base_dir }}/jenkins_home/casc_configs"
  - path: "{{ __docker_stack__jenkins_jcac__data_dir }}"
  - path: "{{ __docker_stack__jenkins_jcac__data_dir }}/osimages"
  - path: "{{ __docker_stack__jenkins_jcac__vmware_data_dir }}"

__docker_stack__jenkins_jcac__config_tpls:
  - src: 'jenkins_jcac/jenkins.env.j2'
    dest: "{{ __docker_stack__jenkins_jcac__base_dir }}/jenkins.env"
  - src: 'jenkins_jcac/jenkins_casc.yml.j2'
    dest: "{{ __docker_stack__jenkins_jcac__base_dir }}/jenkins_home/casc_configs/jenkins.yml"
  - src: 'jenkins_jcac/job_dsl/seedjob.groovy'
    dest: "{{ __docker_stack__jenkins_jcac__base_dir }}/jenkins_home/casc_configs/seedjob.groovy"
    force: yes
  - src: 'jenkins_jcac/config-group.conf.j2'
    dest: "{{ __docker_stack__jenkins_jcac__base_dir }}/group"
  - src: 'jenkins_jcac/config-passwd.conf.j2'
    dest: "{{ __docker_stack__jenkins_jcac__base_dir }}/passwd"

__docker_stack__jenkins_jcac__firewalld_ports:
  - "{{ __docker_stack__jenkins_jcac__agent_tcp_port }}/tcp"
  - "{{ __docker_stack__jenkins_jcac__agent_ssh_port }}/tcp"


#########
## Credential vars

__docker_stack__jenkins_cred_ansible_vault_password_default: "{{ _vaulted_credentials['ansible_vault_password'] }}"
__docker_stack__jenkins_cred_ansible_vault_password: "{{ docker_stack__jenkins_cred_ansible_vault_password
  | d(__docker_stack__jenkins_cred_ansible_vault_password_default) }}"

__docker_stack__jenkins_cred_bitbucket_ssh_username_default: "{{ _vaulted_credentials['ansible_bitbucket_ssh_username'] }}"
__docker_stack__jenkins_cred_bitbucket_ssh_username: "{{ docker_stack__jenkins_cred_bitbucket_ssh_username
  | d(__docker_stack__jenkins_cred_bitbucket_ssh_username_default) }}"

__docker_stack__jenkins_cred_bitbucket_ssh_private_key_default: "{{ _vaulted_credentials['ansible_bitbucket_ssh_private_key'] }}"
__docker_stack__jenkins_cred_bitbucket_ssh_private_key: "{{ docker_stack__jenkins_cred_bitbucket_ssh_private_key
  | d(__docker_stack__jenkins_cred_bitbucket_ssh_private_key_default) }}"

__docker_stack__jenkins_cred_ansible_ssh_username_linux_default: "{{ _vaulted_credentials['ansible_user_linux'] }}"
__docker_stack__jenkins_cred_ansible_ssh_username_linux: "{{ docker_stack__jenkins_cred_ansible_ssh_username_linux
  | d(__docker_stack__jenkins_cred_ansible_ssh_username_linux_default) }}"

__docker_stack__jenkins_cred_ansible_ssh_password_linux_default: "{{ _vaulted_credentials['ansible_password_linux'] }}"
__docker_stack__jenkins_cred_ansible_ssh_password_linux: "{{ docker_stack__jenkins_cred_ansible_ssh_password_linux
  | d(__docker_stack__jenkins_cred_ansible_ssh_password_linux_default) }}"

__docker_stack__jenkins_cred_ansible_username_windows_default: "{{ _vaulted_credentials['ansible_user_windows'] }}"
__docker_stack__jenkins_cred_ansible_username_windows: "{{ docker_stack__jenkins_cred_ansible_username_windows
  | d(__docker_stack__jenkins_cred_ansible_username_windows_default) }}"

__docker_stack__jenkins_cred_ansible_password_windows_default: "{{ _vaulted_credentials['ansible_password_windows'] }}"
__docker_stack__jenkins_cred_ansible_password_windows: "{{ docker_stack__jenkins_cred_ansible_password_windows
  | d(__docker_stack__jenkins_cred_ansible_password_windows_default) }}"

__docker_stack__jenkins_cred_ansible_integration_username_default: "{{ _vaulted_credentials['ansible_integration_username'] }}"
__docker_stack__jenkins_cred_ansible_integration_username: "{{ docker_stack__jenkins_cred_ansible_integration_username
  | d(__docker_stack__jenkins_cred_ansible_integration_username_default) }}"

__docker_stack__jenkins_cred_ansible_integration_password_default: "{{ _vaulted_credentials['ansible_integration_password'] }}"
__docker_stack__jenkins_cred_ansible_integration_password: "{{ docker_stack__jenkins_cred_ansible_integration_password
  | d(__docker_stack__jenkins_cred_ansible_integration_password_default) }}"

__docker_stack__jenkins_cred_ansible_bitbucket_api_username_default: "{{ _vaulted_credentials['ansible_bitbucket_api_username'] }}"
__docker_stack__jenkins_cred_ansible_bitbucket_api_username: "{{ docker_stack__jenkins_cred_ansible_bitbucket_api_username
  | d(__docker_stack__jenkins_cred_ansible_bitbucket_api_username_default) }}"

__docker_stack__jenkins_cred_ansible_bitbucket_api_password_default: "{{ _vaulted_credentials['ansible_bitbucket_api_password'] }}"
__docker_stack__jenkins_cred_ansible_bitbucket_api_password: "{{ docker_stack__jenkins_cred_ansible_bitbucket_api_password
  | d(__docker_stack__jenkins_cred_ansible_bitbucket_api_password_default) }}"

__docker_stack__jenkins_vsphere_location_default: "DFW"
__docker_stack__jenkins_vsphere_location: "{{
  docker_stack__jenkins_vsphere_location | d(__docker_stack__jenkins_vsphere_location_default) }}"
__docker_stack__jenkins_cred_vsphere_hostname_default: "{{
  _vaulted_credentials['vsphere_credentials'][__docker_stack__jenkins_vsphere_location].host }}"
__docker_stack__jenkins_cred_vsphere_hostname: "{{ docker_stack__jenkins_cred_vsphere_hostname
  | d(__docker_stack__jenkins_cred_vsphere_hostname_default) }}"

__docker_stack__jenkins_cred_vsphere_username_default: "{{
  _vaulted_credentials['vsphere_credentials'][__docker_stack__jenkins_vsphere_location].username }}"
__docker_stack__jenkins_cred_vsphere_username: "{{ docker_stack__jenkins_cred_vsphere_username
  | d(__docker_stack__jenkins_cred_vsphere_username_default) }}"

__docker_stack__jenkins_cred_vsphere_password_default: "{{
  _vaulted_credentials['vsphere_credentials'][__docker_stack__jenkins_vsphere_location].password }}"
__docker_stack__jenkins_cred_vsphere_password: "{{ docker_stack__jenkins_cred_vsphere_password
  | d(__docker_stack__jenkins_cred_vsphere_password_default) }}"

## AAC Jenkins Tokens
__docker_stack__jenkins_cred_aac_jenkins_token_sandbox: "{{ _vaulted_credentials['aac_jenkins_token_sandbox'] }}"
__docker_stack__jenkins_cred_aac_jenkins_token_dev: "{{ _vaulted_credentials['aac_jenkins_token_dev'] }}"
__docker_stack__jenkins_cred_aac_jenkins_token_qa: "{{ _vaulted_credentials['aac_jenkins_token_qa'] }}"
__docker_stack__jenkins_cred_aac_jenkins_token_prod: "{{ _vaulted_credentials['aac_jenkins_token_prod'] }}"

## AAP credential "Private Automation Hub", vault_credential: private_hub_token, local var: 'token'
__docker_stack__jenkins_cred_ansible_galaxy_pah_token_default: "{{ _vaulted_credentials['private_hub_token'] }}"
__docker_stack__jenkins_cred_ansible_galaxy_pah_token: "{{ docker_stack__jenkins_cred_ansible_galaxy_pah_token
  | d(__docker_stack__jenkins_cred_ansible_galaxy_pah_token_default) }}"

__docker_stack__jenkins_ansible_venv_libs_default:
  - jmespath
  - netaddr
  - requests
  - requests-credssp
  - pywinrm
  - pytz
  - python-dateutil
  - yamllint

__docker_stack__jenkins_ansible_venv_libs: "{{ docker_stack__jenkins_ansible_venv_libs
  | d(__docker_stack__jenkins_ansible_venv_libs_default) }}"


## tower management
__docker_stack__jenkins_cred_tower_management_vault_password_default: "{{
  _vaulted_credentials['tower_management_vault_password'] }}"
__docker_stack__jenkins_cred_tower_management_vault_password: "{{
  docker_stack__jenkins_cred_tower_management_vault_password
    | d(__docker_stack__jenkins_cred_tower_management_vault_password_default) }}"

#__docker_stack__jenkins_cred_docker_registry_admin_password: "{{ docker_stack__jenkins_cred_docker_registry_admin_password | d('CHANGEME123') }}"

__docker_stack__jenkins_cred_jenkins_admin_user_username_default: "{{ _vaulted_credentials['jenkins_agent_username'] }}"
__docker_stack__jenkins_cred_jenkins_admin_user_username: "{{ docker_stack__jenkins_cred_jenkins_admin_user_username
  | d(__docker_stack__jenkins_cred_jenkins_admin_user_username_default) }}"

__docker_stack__jenkins_cred_jenkins_admin_user_password_default: "{{ _vaulted_credentials['jenkins_agent_password'] }}"
__docker_stack__jenkins_cred_jenkins_admin_user_password: "{{ docker_stack__jenkins_cred_jenkins_admin_user_password
  | d(__docker_stack__jenkins_cred_jenkins_admin_user_password_default) }}"

#__docker_stack__jenkins_cred_jenkins_git_user_password: "{{ docker_stack__jenkins_cred_jenkins_git_user_password | d('CHANGEME123') }}"
#
#__docker_stack__jenkins_cred_ansible_ssh_key: "{{ docker_stack__jenkins_cred_ansible_ssh_key | d('CHANGEME123') }}"
#
#__docker_stack__jenkins_cred_esxi_password: "{{ docker_stack__jenkins_cred_esxi_password | d('CHANGEME123') }}"

#__docker_stack__jenkins_cred_packer_user_username_default: packer
__docker_stack__jenkins_cred_packer_user_username_default: osbuild
__docker_stack__jenkins_cred_packer_user_username: "{{ docker_stack__jenkins_cred_packer_user_username
  | d(__docker_stack__jenkins_cred_packer_user_username_default) }}"

__docker_stack__jenkins_cred_packer_user_password_default: "{{ _vaulted_credentials['packer_user_password'] }}"
__docker_stack__jenkins_cred_packer_user_password: "{{ docker_stack__jenkins_cred_packer_user_password
  | d(__docker_stack__jenkins_cred_packer_user_password_default) }}"

#__docker_stack__jenkins_cred_vm_root_password_default: "{{ _vaulted_credentials['vm_root_password'] }}"
#__docker_stack__jenkins_cred_vm_root_password: "{{ docker_stack__jenkins_cred_vm_root_password
#  | d(__docker_stack__jenkins_cred_vm_root_password_default) }}"


__docker_stack__jenkins_jcac__secrets:
  - name: ldap_username
    value: "{{ __docker_stack__jenkins_jcac__ldap_bind_user_dn }}"
  - name: ldap_password
    value: "{{ __docker_stack__jenkins_jcac__ldap_bind_user_password }}"
  - name: jenkins_admin_username
    value: "{{ __docker_stack__jenkins_cred_jenkins_admin_user_username }}"
  - name: jenkins_admin_password
    value: "{{ __docker_stack__jenkins_cred_jenkins_admin_user_password }}"
#  - name: jenkins_git_password
#    value: "{{ __docker_stack__jenkins_cred_jenkins_git_user_password }}"
#  - name: docker_registry_password
#    value: "{{ __docker_stack__jenkins_cred_docker_registry_admin_password }}"
  - name: vsphere_username
    value: "{{ __docker_stack__jenkins_cred_vsphere_username }}"
  - name: vsphere_password
    value: "{{ __docker_stack__jenkins_cred_vsphere_password }}"
#  - name: vmware_esxi_password
#    value: "{{ __docker_stack__jenkins_cred_esxi_password }}"
  - name: packer_user_username
    value: "{{ __docker_stack__jenkins_cred_packer_user_username }}"
  - name: packer_user_password
    value: "{{ __docker_stack__jenkins_cred_packer_user_password }}"
  - name: ansible_vault_password
    value: "{{ __docker_stack__jenkins_cred_ansible_vault_password }}"
  - name: tower_management_vault_password
    value: "{{ __docker_stack__jenkins_cred_tower_management_vault_password }}"
  - name: ansible_ssh_username_linux
    value: "{{ __docker_stack__jenkins_cred_ansible_ssh_username_linux }}"
  - name: ansible_ssh_password_linux
    value: "{{ __docker_stack__jenkins_cred_ansible_ssh_password_linux }}"
  - name: ansible_username_windows
    value: "{{ __docker_stack__jenkins_cred_ansible_username_windows }}"
  - name: ansible_password_windows
    value: "{{ __docker_stack__jenkins_cred_ansible_password_windows }}"
#  - name: ansible_ssh_private_key
#    value: "{{ __docker_stack__jenkins_cred_ansible_ssh_key }}"
  - name: aac_jenkins_token_sandbox
    value: "{{ __docker_stack__jenkins_cred_aac_jenkins_token_sandbox }}"
  - name: aac_jenkins_token_dev
    value: "{{ __docker_stack__jenkins_cred_aac_jenkins_token_dev }}"
  - name: aac_jenkins_token_qa
    value: "{{ __docker_stack__jenkins_cred_aac_jenkins_token_qa }}"
  - name: aac_jenkins_token_prod
    value: "{{ __docker_stack__jenkins_cred_aac_jenkins_token_prod }}"
  - name: bitbucket_ssh_username
    value: "{{ __docker_stack__jenkins_cred_bitbucket_ssh_username }}"
  - name: bitbucket_ssh_private_key
    value: "{{ __docker_stack__jenkins_cred_bitbucket_ssh_private_key }}"
  - name: ansible_galaxy_pah_token
    value: "{{ __docker_stack__jenkins_cred_ansible_galaxy_pah_token }}"
  - name: ansible_integration_username
    value: "{{ __docker_stack__jenkins_cred_ansible_integration_username }}"
  - name: ansible_integration_password
    value: "{{ __docker_stack__jenkins_cred_ansible_integration_password }}"
  - name: ansible_bitbucket_api_username
    value: "{{ __docker_stack__jenkins_cred_ansible_bitbucket_api_username }}"
  - name: ansible_bitbucket_api_password
    value: "{{ __docker_stack__jenkins_cred_ansible_bitbucket_api_password }}"



docker_stack__jenkins_jcac__firewalld_appspec_ports:
  - "{{ __docker_stack__jenkins_jcac__agent_tcp_port }}/tcp"
  - "{{ __docker_stack__jenkins_jcac__agent_ssh_port }}/tcp"

docker_stack__appspec__jenkins_jcac:
  dirs: "{{ __docker_stack__jenkins_jcac__config_dirs | d([]) }}"
  files: "{{ __docker_stack__jenkins_jcac__config_files | d([]) }}"
  templates: "{{ __docker_stack__jenkins_jcac__config_tpls | d([]) }}"
  secrets: "{{ __docker_stack__jenkins_jcac__secrets | d({}) }}"
  firewalld_services: "{{ __docker_stack__jenkins_jcac__firewalld_services | d([]) }}"
  firewalld_ports: "{{ __docker_stack__jenkins_jcac__firewalld_ports | d([]) }}"
  networks: "{{ __docker_stack__jenkins_jcac__networks | d({}) }}"
  volumes: "{{ __docker_stack__jenkins_jcac__volumes | d({}) }}"
  docker_services: "{{ __docker_stack__jenkins_jcac__services | d({}) }}"

__docker_stack__jenkins_jcac__traefik_labels: "{{ docker_stack__jenkins_jcac__traefik_labels
  | d(__docker_stack__jenkins_jcac__traefik_labels_default) }}"

__docker_stack__jenkins_jcac__services:

  ## ref: https://github.com/jenkinsci/docker
  ## ref: https://medium.com/swlh/quickstart-ci-with-jenkins-and-docker-in-docker-c3f7174ee9ff
  ## ref: https://github.com/4OH4/jenkins-docker
  ## ref: https://github.com/lj020326/jenkins-docker
  jenkins-jcac:
    image: "{{ __docker_stack__jenkins_jcac__image }}"
    container_name: jenkins-jcac
    restart: "unless-stopped"
#    depends_on:
#      - socket-proxy
    user: "{{ docker_stack__user_uid }}:{{ docker_stack__user_gid }}"
    networks:
      - "{{ docker_stack__traefik_proxy_network }}"
      - socket_proxy
    ports:
      - mode: host
        protocol: tcp
        published: "{{ __docker_stack__jenkins_jcac__http }}"
        target: 8080
      - mode: host
        protocol: tcp
        published: "{{ __docker_stack__jenkins_jcac__agent_port }}"
        target: 9000
#      - "{{ __docker_stack__jenkins_jcac__http }}:8080/tcp"  ## jenkins web server
#      - "{{ __docker_stack__jenkins_jcac__agent_port }}:9000/tcp"
#      command: "--httpsCertificate=/var/lib/jenkins/cert --httpsPrivateKey=/var/lib/jenkins/pk"
    volumes:
      - "{{ __docker_stack__ca_cert_bundle }}:/etc/ssl/certs/ca-certificates.crt:ro"
      - "{{ __docker_stack__ca_java_keystore }}:/var/lib/jenkins/cacerts"
      - "{{ __docker_stack__jenkins_jcac__base_dir }}/passwd:/etc/passwd:ro"
      - "{{ __docker_stack__jenkins_jcac__base_dir }}/group:/etc/group:ro"
      - "{{ __docker_stack__jenkins_jcac__base_dir }}/jenkins_home:/var/jenkins_home"
      - "{{ __docker_stack__jenkins_jcac__data_dir }}:/data"
      - "{{ __docker_stack__jenkins_jcac__vmware_data_dir }}:/vmware"
    env_file:
      - jenkins_jcac/jenkins.env
    secrets:
      - ldap_username
      - ldap_password
      - jenkins_admin_username
      - jenkins_admin_password
#      - jenkins_git_password
#      - docker_registry_password
      - vsphere_username
      - vsphere_password
#      - vmware_esxi_password
      - packer_user_username
      - packer_user_password
      - ansible_galaxy_pah_token
      - ansible_vault_password
      - tower_management_vault_password
      - ansible_ssh_username_linux
      - ansible_ssh_password_linux
      - ansible_username_windows
      - ansible_password_windows
#      - ansible_ssh_private_key
      - aac_jenkins_token_sandbox
      - aac_jenkins_token_dev
      - aac_jenkins_token_qa
      - aac_jenkins_token_prod
      - bitbucket_ssh_username
      - bitbucket_ssh_private_key
      - ansible_integration_username
      - ansible_integration_password
      - ansible_bitbucket_api_username
      - ansible_bitbucket_api_password
#      - github_ssh_username
#      - github_ssh_password
    deploy:
      #############
      ## Set endpoint_mode to `dnsrr` for container to have local dns access
      ## https://stackoverflow.com/questions/52665442/docker-swarm-host-cannot-resolve-hosts-on-other-nodes
      ## https://docs.docker.com/compose/compose-file/compose-file-v3/#endpoint_mode
      endpoint_mode: dnsrr
      mode: replicated
      placement:
        constraints:
          - node.hostname == {{ __docker_stack__jenkins_jcac__host }}
#          - node.role == manager
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 3
        window: 120s
    labels: "{{ __docker_stack__jenkins_jcac__traefik_labels }}"
