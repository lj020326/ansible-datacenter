---

- name: "Update yum package repos"
  when:
    - ansible_pkg_mgr == 'yum'
    - bootstrap_linux_package_yum_repo_list|d([])|length>0
  include_tasks: update-repo-yum.yml

- name: "Update apt package repos"
  when:
    - ansible_pkg_mgr == 'apt'
    - bootstrap_linux_package_apt_repo_list|d([])|length>0
  include_tasks: update-repo-apt.yml

- name: "Install present packages"
  when:
    - __bootstrap_linux_package_list_by_priority[item].present is defined
    - __bootstrap_linux_package_list_by_priority[item].present.keys()|d([])|length>0
  package:
    name: "{{ __bootstrap_linux_package_list_by_priority[item].present.keys() }}"
    state: "present"
    update_cache: "{{ bootstrap_linux_package_update_cache }}"
  loop: "{{ __bootstrap_linux_package_list_by_priority.keys()|sort }}"
  loop_control:
    label: "package state=present priority={{ item }}"

- name: "Install latest packages"
  when:
    - __bootstrap_linux_package_list_by_priority[item].latest is defined
    - __bootstrap_linux_package_list_by_priority[item].latest.keys()|d([])|length>0
  package:
    name: "{{ __bootstrap_linux_package_list_by_priority[item].latest.keys() }}"
    state: "latest"
    update_cache: "{{ bootstrap_linux_package_update_cache }}"
  loop: "{{ __bootstrap_linux_package_list_by_priority.keys()|sort }}"
  loop_control:
    label: "package state=latest priority={{ item }}"

- name: "Remove packages"
  when:
    - __bootstrap_linux_package_list_by_priority[item].absent is defined
    - __bootstrap_linux_package_list_by_priority[item].absent.keys()|d([])|length>0
  package:
    name: "{{ __bootstrap_linux_package_list_by_priority[item].absent.keys() }}"
    state: "absent"
    update_cache: "{{ bootstrap_linux_package_update_cache }}"
  loop: "{{ __bootstrap_linux_package_list_by_priority.keys()|sort }}"
  loop_control:
    label: "package state=absent priority={{ item }}"
