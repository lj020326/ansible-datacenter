---
- name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__* vars"
  when: docker_stack__openldap__debug|d(False)|bool
  block:
    - name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__base_user_map"
      ansible.builtin.debug:
        var: __docker_stack__openldap__base_user_map

    - name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__domain_ou_map"
      ansible.builtin.debug:
        var: __docker_stack__openldap__domain_ou_map

    - name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__samba_domain_map"
      ansible.builtin.debug:
        var: __docker_stack__openldap__samba_domain_map

    - name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__domain_user_map"
      ansible.builtin.debug:
        var: __docker_stack__openldap__domain_user_map

    - name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__domain_user_map_combined"
      ansible.builtin.debug:
        var: __docker_stack__openldap__domain_user_map_combined

    - name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__domain_group_map"
      ansible.builtin.debug:
        var: __docker_stack__openldap__domain_group_map

    - name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__domain_group_map_combined"
      ansible.builtin.debug:
        var: __docker_stack__openldap__domain_group_map_combined

    - name: "Docker Stack | openldap | pre-setup | Display __docker_stack__openldap__services"
      ansible.builtin.debug:
        var: __docker_stack__openldap__services

- name: "Docker Stack | openldap | pre-setup | Check if {{ __docker_stack__openldap__tls_dh_param_path }} exists"
  ansible.builtin.stat:
    path: "{{ __docker_stack__openldap__cert_path }}/{{ __docker_stack__openldap__tls_dh_param_path }}"
  register: __dhparam_pem_file

- name: "Docker Stack | openldap | pre-setup | Setup dhparam.pem"
  when: not __dhparam_pem_file.stat.exists|bool
  ansible.builtin.command: >
    openssl dhparam -out {{ __docker_stack__openldap__cert_path }}/{{ __docker_stack__openldap__tls_dh_param_path }} 2048
  changed_when: false
  failed_when: false
