---
- name: "{{ __docker_stack__log_prefix__setup_admin_scripts }} Ensure script dirs exist"
  ansible.builtin.file:
    path: "{{ item.path }}"
    state: directory
    #    owner: "{{ item.owner | d(docker_stack__user_username) }}"
    #    group: "{{ item.owner | d(docker_stack__user_group) }}"
    owner: "{{ item.owner | d('root') }}"
    group: "{{ item.owner | d('root') }}"
    mode: "{{ item.mode | d(omit) }}"
    recurse: "{{ item.recurse | d(omit) }}"
  loop: "{{ docker_stack__script_dirs }}"

- name: "{{ __docker_stack__log_prefix__setup_admin_scripts }} Display docker_stack__scripts"
  ansible.builtin.debug:
    var: docker_stack__scripts

## ref: http://www.mydailytutorials.com/ansible-template-module-examples/
- name: "{{ __docker_stack__log_prefix__setup_admin_scripts }} Install docker stack admin/utility scripts"
  ansible.builtin.copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    force: "{{ item.force | d('true') }}"
    ## ref: https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html
    mode: "{{ item.mode | d('0770') }}"
    #    owner: "{{ item.owner | d(docker_stack__user_username) }}"
    #    group: "{{ item.owner | d(docker_stack__user_group) }}"
    owner: "{{ item.owner | d('root') }}"
    group: "{{ item.owner | d('root') }}"
  loop: "{{ docker_stack__scripts }}"

## ref: http://www.mydailytutorials.com/ansible-template-module-examples/
- name: "{{ __docker_stack__log_prefix__setup_admin_scripts }} Install admin script configs"
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    #    force: "{{ item.force | d('true') }}"
    ## ref: https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html
    mode: "{{ item.mode | d('0770') }}"
    #    owner: "{{ item.owner | d(docker_stack__user_username) }}"
    #    group: "{{ item.owner | d(docker_stack__user_group) }}"
    owner: "{{ item.owner | d('root') }}"
    group: "{{ item.owner | d('root') }}"
  loop: "{{ docker_stack__script_config_tpls | d([]) }}"

- name: "{{ __docker_stack__log_prefix__setup_admin_scripts }} Display docker_stack__admin_jobs"
  ansible.builtin.debug:
    var: docker_stack__admin_jobs

- name: "{{ __docker_stack__log_prefix__setup_admin_scripts }} Create admin cron jobs"
  when: docker_stack__admin_jobs | d([])| count>0
  ansible.builtin.cron:
    name: "{{ item.name }}"
    special_time: "{{ item.special_time | d(omit) }}"
    minute: "{{ item.minute | d(omit) }}"
    hour: "{{ item.hour | d(omit) }}"
    job: "{{ item.job }}"
  loop: "{{ docker_stack__admin_jobs }}"
