---

__docker_stack__mariadb__root_password: "{{ docker_stack__mysql__root_password | d('password') }}"
__docker_stack__mariadb__port: 3306

docker_stack__phpmyadmin_port: 8802

__docker_stack__mariadb__config_dirs:
  - { path: "{{ docker_stack__dir }}/mariadb" }
  - { path: "{{ docker_stack__dir }}/mariadb/config" }
  - { path: "{{ docker_stack__dir }}/mariadb/config/initdb.d" }
#    - { path: "{{ docker_stack__dir }}/mariadb/database" }

__docker_stack__mariadb__config_tpls:
  - { src: mariadb/custom.conf.j2, dest: "{{ docker_stack__dir }}/mariadb/custom.cnf", backup: true }
#    - { src: 'fog/fog.sql.j2', dest: "{{ docker_stack__dir }}/mariadb/initdb.d/fog.sql" }

#__docker_stack__mariadb__config_files:
#  - src: 'files/postgres/create-multiple-pg-databases.sh'
#    mode: '0755'
#    dest: "{{ docker_stack__dir }}/postgres/multiple-dbs/create-multiple-pg-databases.sh"

__docker_stack__mariadb__firewalld_ports:
  - "{{ __docker_stack__mariadb__port }}/tcp"
  - "{{ docker_stack__phpmyadmin_port }}/tcp"

docker_stack__appspec__mariadb:
  dirs: "{{ __docker_stack__mariadb__config_dirs | d([]) }}"
  files: "{{ __docker_stack__mariadb__config_files | d([]) }}"
  templates: "{{ __docker_stack__mariadb__config_tpls | d([]) }}"
  firewalld_services: "{{ __docker_stack__mariadb__firewalld_services | d([]) }}"
  firewalld_ports: "{{ __docker_stack__mariadb__firewalld_ports | d([]) }}"
  docker_services: "{{ __docker_stack__mariadb__services | d({}) }}"

__docker_stack__mariadb__services:
  ######### UTILITIES ##########
  ## MariaDB â€“ Database Server for your Apps
  mariadb:
    image: linuxserver/mariadb
    container_name: mariadb
    hostname: mariadb
    user: "{{ docker_stack__user_uid }}:{{ docker_stack__user_gid }}"
    ports:
      - "{{ __docker_stack__mariadb__port }}:3306"
    restart: unless-stopped
    networks:
      - "{{ docker_stack__network_name__default }}"
    environment:
      MYSQL_ROOT_PASSWORD: "{{ __docker_stack__mariadb__root_password }}"
      PUID: "{{ docker_stack__user_uid }}"
      PGID: "{{ docker_stack__user_gid }}"
      TZ: "{{ docker_stack__timezone }}"
    volumes:
      - "{{ docker_stack__dir }}/mariadb:/config"
  #        - "{{ docker_stack__dir }}/mariadb/config:/config"
  #        - "{{ docker_stack__dir }}/mariadb/database:/var/lib/mysql"
  #        - "{{ docker_stack__dir }}/mariadb/config/fog.sql:/docker-entrypoint-initdb.d/fog.sql"
  #        - ./storage/fog/database:/var/lib/mysql
  #        - ./storage/fog/config/fog.sql:/docker-entrypoint-initdb.d/fog.sql

  ## WebUI for MariaDB
  phpmyadmin:
    hostname: phpmyadmin
    container_name: phpmyadmin
    image: phpmyadmin/phpmyadmin
    restart: unless-stopped
    links:
      - mariadb:db
    depends_on:
      - mariadb
    ports:
      - "{{ docker_stack__phpmyadmin_port }}:80"
    environment:
      PMA_HOST: mariadb
      MYSQL_ROOT_PASSWORD: "{{ __docker_stack__mariadb__root_password }}"
    networks:
      #        - "{{ docker_stack__network_name__default }}"
      - "{{ docker_stack__network_name__traefik_proxy }}"
      - "{{ docker_stack__network_name__default }}"
    labels: "{{ __docker_stack__mariadb_phpmyadmin__traefik_labels }}"
