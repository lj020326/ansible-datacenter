---

#__docker_stack__openbao__endpoint: "vault.{{ __docker_stack__openbao__domain }}"

__docker_stack__openbao__traefik_labels_base_default:
  - "traefik.enable=true"
  - "traefik.http.routers.openbao.entrypoints=https"
  - "traefik.http.routers.openbao.rule=Host(`{{ __docker_stack__openbao__host_addr }}`)"
  - "traefik.http.routers.openbao.service=openbao-svc"
  # Add middleware to ensure X-Forwarded-Proto is set to https
  - "traefik.http.services.openbao-svc.loadbalancer.server.port={{ __docker_stack__openbao__bind_http_port }}"
  - "traefik.http.services.openbao-svc.loadbalancer.server.scheme=http"
  # Define the middleware for setting X-Forwarded-Proto
  - "traefik.http.middlewares.openbao-forwarded-headers.headers.customrequestheaders.X-Forwarded-Proto=https"
  - "traefik.http.middlewares.openbao-forwarded-headers.headers.customrequestheaders.X-Forwarded-Host={{ __docker_stack__openbao__host_addr }}"

__docker_stack__openbao__traefik_labels_default: >-
  {{
    __docker_stack__openbao__traefik_labels_base_default
    + (__docker_stack__traefik__labels_swarm_default if docker_stack__swarm_mode | bool else [])
  }}
