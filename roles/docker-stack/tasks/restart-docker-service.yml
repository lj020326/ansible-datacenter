---

- set_fact:
    __log_prefix_local: "Docker Stack | Restart Docker Service |"

- name: "{{ __log_prefix_local }} Shut down services defined in docker-compose.yml"
  ignore_errors: yes
  community.docker.docker_compose:
    project_src: "{{ docker_stack_dir }}"
    remove_orphans: "{{ docker_stack_remove_orphans }}"
    state: absent
  register: __compose_result
  retries: 5
  delay: 20
  until: __compose_result is not failed

- name: "{{ __log_prefix_local }} Restart docker service"
  service:
    name: docker
    state: restarted
  register: __service_result
  retries: 3
  delay: 10
  until: __service_result is not failed

- name: "{{ __log_prefix_local }} Display __service_result"
  debug:
    var: __service_result
