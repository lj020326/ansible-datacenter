---

- set_fact:
    log_prefix_local: "setup-service-configs |"

- name: "{{ log_prefix_local }} Display docker_stack_networks"
  debug:
    var: docker_stack_networks
    verbosity: 1

- name: "{{ log_prefix_local }} Create external docker networks for stack if necessary"
  when: item.value.external|d(False)|bool
  community.docker.docker_network:
    name: "{{ item.key }}"
  with_dict: "{{ docker_stack_networks }}"

- name: "{{ log_prefix_local }} Create docker secrets for stack if necessary"
  when: item.value.external|d(False)|bool
  community.docker.docker_secret:
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    labels: "{{ item.labels | d(omit) }}"
    state: present
  with_dict: "{{ docker_stack_secrets }}"
