---

docker_stack_appspec_services__jenkins_jcac:

  ## ref: https://github.com/jenkinsci/docker
  ## ref: https://medium.com/swlh/quickstart-ci-with-jenkins-and-docker-in-docker-c3f7174ee9ff
  ## ref: https://github.com/4OH4/jenkins-docker
  ## ref: https://github.com/lj020326/jenkins-docker
  jenkins_jcac:
    image: "{{ __docker_stack_appspecs__jenkins_jcac_image }}"
    container_name: jenkins_jcac
    restart: "unless-stopped"
    depends_on:
      - socket-proxy
    user: "{{ docker_stack_user_uid }}:{{ docker_stack_user_gid }}"
    networks:
      - "{{ docker_stack_traefik_proxy_network }}"
      - socket_proxy
    ports:
      - "{{ __docker_stack_appspecs__jenkins_jcac_http }}:8080/tcp"  ## jenkins web server
      - "{{ __docker_stack_appspecs__jenkins_jcac_agent_port }}:9000/tcp"
#      command: "--httpsCertificate=/var/lib/jenkins/cert --httpsPrivateKey=/var/lib/jenkins/pk"
    volumes:
      - "{{ __docker_stack_appspecs__jenkins_jcac_base_dir }}/jenkins_casc.yml:/var/jenkins_casc.yml"
      - "{{ __docker_stack_appspecs__jenkins_jcac_base_dir }}/passwd:/etc/passwd:ro"
      - "{{ __docker_stack_appspecs__jenkins_jcac_base_dir }}/group:/etc/group:ro"
#      - "{{ __docker_stack_appspecs__jenkins_jcac_base_dir }}/jenkins_home:/var/jenkins_home"
      - "{{ docker_stack_ca_cert_bundle }}:/etc/ssl/certs/ca-certificates.crt:ro"
      - "{{ docker_stack_ca_java_keystore }}:/var/lib/jenkins/cacerts"
#      - "{{ __docker_stack_appspecs__jenkins_jcac_data_dir }}:/data"
#      - "{{ __docker_stack_vmware_data_dir }}:/vmware"
    env_file:
      - jenkins_jcac/jenkins.env
    labels:
      traefik.enable: true
      traefik.http.routers.jenkins.entrypoints: https
      traefik.http.routers.jenkins.rule: Host(`jenkins.{{ docker_stack_internal_domain }}`)
      ## ref: https://community.traefik.io/t/pathprefix-and-strip/2122/2
      traefik.http.services.jenkins.loadbalancer.server.port: 8080
#      traefik.http.routers.jenkins_insecure.entrypoints: http
#      traefik.http.routers.jenkins_insecure.rule: Host(`jenkins.{{ docker_stack_internal_domain }}`)
#      traefik.http.routers.jenkins_insecure.middlewares: https-only@file
