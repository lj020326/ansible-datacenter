---
bootstrap_pki__vault_url: "https://vault.example.int"
bootstrap_pki__vault_token: ""
## verify capabilities for the following tokens
bootstrap_pki__vault_verify_token_capabilities: []
bootstrap_pki__vault_api_version: "v1"

# Enable KV v2 engine at this path
bootstrap_pki__vault_kv_mount_point: "kv"

bootstrap_pki__vault_mount_path: "pki-intermediate"
bootstrap_pki__vault_ca_root_path: "{{ bootstrap_pki__vault_mount_path }}/root"
bootstrap_pki__use_external_root_ca: false
bootstrap_pki__debug: false

bootstrap_pki__vault_ensure_admin_token: false

bootstrap_pki__ca_basename: "ca"
bootstrap_pki__ca_common_name: "MyOrg Root CA"
bootstrap_pki__ca_key_algo: "rsa"
bootstrap_pki__ca_key_size: 4096
bootstrap_pki__vault_ca_key_algo: "ecdsa"
bootstrap_pki__vault_ca_key_size: 256

bootstrap_pki__ca_cert_duration_root: "438000h" # 50 years
bootstrap_pki__ca_cert_duration_intermediate: "87600h" # 10 years
bootstrap_pki__ca_cert_duration_server: "87600h" # 10 years
bootstrap_pki__ca_cert_duration_client: "87600h" # 10 years
bootstrap_pki__ca_cert_duration_default: "87600h" # 10 years

bootstrap_pki__root_ca_crl_expiry: "8760h" # 1 year

bootstrap_pki__ca_dir: "/etc/pki/cacerts"
bootstrap_pki__ca_reset_cert: false
bootstrap_pki__backup_retention_maximum_number: 10
bootstrap_pki__encrypt_root_ca_key: false
bootstrap_pki__encrypted_root_ca_key_path: "{{ bootstrap_pki__ca_dir }}/{{ bootstrap_pki__root_ca_cert_info.output_basename }}-key.pem.vault"
bootstrap_pki__vault_password: ""

# Admin token configuration
bootstrap_pki__admin_token_display_name: "admin_user_token"
bootstrap_pki__admin_token_policies: ["admin"]
bootstrap_pki__admin_token_ttl: "87600h"  # 10 years, matching intermediate CA

bootstrap_pki__root_ca_cert_info:
  output_basename: "{{ bootstrap_pki__ca_basename }}"
  common_name: "{{ bootstrap_pki__ca_common_name }}"
  country: "{{ bootstrap_pki__ca_country | d(omit) }}"
  state: "{{ bootstrap_pki__ca_state | d(omit) }}"
  locality: "{{ bootstrap_pki__ca_locality | d(omit) }}"
  organization: "{{ bootstrap_pki__ca_organization | d(omit) }}"
  organizational_unit: "{{ bootstrap_pki__ca_organizational_unit | d(omit) }}"
  email_address: "{{ bootstrap_pki__ca_email_address | d(omit) }}"
  key_algo: "{{ bootstrap_pki__ca_key_algo }}"
  key_size: "{{ bootstrap_pki__ca_key_size }}"
  renewal_tolerance_days: 30

bootstrap_pki__vault_ca_cert_info:
  output_basename: "intermediate-ca"
  csr_json_filename: "intermediate-ca-csr.json"
  common_name: "MyOrg Intermediate CA"
  country: "{{ bootstrap_pki__ca_country | d(omit) }}"
  state: "{{ bootstrap_pki__ca_state | d(omit) }}"
  locality: "{{ bootstrap_pki__ca_locality | d(omit) }}"
  organization: "{{ bootstrap_pki__ca_organization | d(omit) }}"
  organizational_unit: "{{ bootstrap_pki__ca_organizational_unit | d(omit) }}"
  email_address: "{{ bootstrap_pki__ca_email_address | d(omit) }}"
  key_algo: "{{ bootstrap_pki__vault_ca_key_algo }}"
  key_size: "{{ bootstrap_pki__vault_ca_key_size }}"
  ca_signing_profile: intermediate_ca
  ca_issuer_path: "{{ bootstrap_pki__ca_dir }}/{{ bootstrap_pki__root_ca_cert_info.output_basename }}.pem"
  ca_issuer_key_path: "{{ bootstrap_pki__ca_dir }}/{{ bootstrap_pki__root_ca_cert_info.output_basename }}-key.pem"
  renewal_tolerance_days: 90

bootstrap_pki__vault_roles:
  - name: "web-server"
    allowed_domains:
      - "example.com"
      - "sub.example.com"
    allow_subdomains: true
    key_type: "rsa"
    key_bits: 2048
    max_ttl: "720h"
    ttl: "24h"
  - name: internal-api
    allowed_domains:
      - api.internal
    allow_subdomains: true
    key_type: "ecdsa"
    key_bits: 256
    max_ttl: "720h"
    ttl: "720h"

# Default CA renewal tolerance in days
bootstrap_pki__ca_renewal_tolerance_days: 30

bootstrap_pki__ca_cfssl_profiles:
  signing:
    default:
      expiry: "{{ bootstrap_pki__ca_cert_duration_default }}"
    profiles:
      intermediate_ca:
        usages:
          - cert sign
          - crl sign
        is_ca: true
        ca_constraint:
          is_ca: true
          max_path_len: 1
        expiry: "{{ bootstrap_pki__ca_cert_duration_intermediate }}"
      server:
        usages:
          - signing
          - digital signature
          - key encipherment
          - server auth
        expiry: "{{ bootstrap_pki__ca_cert_duration_client }}"
      client:
        usages:
          - signing
          - digital signature
          - key encipherment
          - client auth
        expiry: "{{ bootstrap_pki__ca_cert_duration_root }}"
