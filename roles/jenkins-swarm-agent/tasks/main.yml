---

- name: "Load OS distribution vars"
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution|lower() }}-{{ ansible_distribution_major_version|lower() }}.yml"
    - "{{ ansible_distribution|lower() }}.yml"
    - "{{ ansible_os_family|lower() }}.yml"
    - "default.yml"

- name: "Display jenkins_swarm_agent_master"
  debug:
    var: jenkins_swarm_agent_master

- name: "Display jenkins_swarm_agent_labels"
  debug:
    var: jenkins_swarm_agent_labels|flatten

- name: "Display jenkins_swarm_jenkins_user_groups"
  debug:
    var: jenkins_swarm_jenkins_user_groups

- name: "Running Jenkins Agent install tasks for {{ ansible_os_family|lower() }}"
  include_tasks: "{{ task_file }}"
  with_first_found:
    - "{{ ansible_distribution|lower() }}-{{ ansible_distribution_major_version|lower() }}.yml"
    - "{{ ansible_distribution|lower() }}.yml"
    - "{{ ansible_os_family|lower() }}.yml"
  loop_control:
    loop_var: task_file

## TODO: fetch token using jenkins API and set the token in the swarm agent config
## ref: https://stackoverflow.com/questions/42683324/create-jenkins-jlnp-slave-programmatically
## ref: https://plugins.jenkins.io/swarm/
## ref: https://github.com/jenkinsci/swarm-plugin/blob/master/docs/configfile.adoc
## ref: https://github.com/jenkinsci/swarm-plugin/blob/master/docs/security.adoc#authentication
