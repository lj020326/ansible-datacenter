---

- name: "get_cert_facts | Set __deploy_cacerts__ca_intermediate_certs"
  set_fact:
    __deploy_cacerts__ca_intermediate_certs: "{{ __deploy_cacerts__ca_intermediate_certs|default({}) | combine( { item.commonName: item } )  }}"
  loop: "{{ deploy_cacerts__ca_intermediate_certs_list }}"

- name: "get_cert_facts | Set __deploy_cacerts__ca_intermediate_cert_list"
  set_fact:
    __deploy_cacerts__ca_intermediate_cert_list: "{{ __deploy_cacerts__ca_intermediate_certs.values() | list }}"
#    __deploy_cacerts__ca_signer_certs: "{{ { deploy_cacerts__ca_root_cn: ca_root } | combine(__deploy_cacerts__ca_intermediate_certs) }}"

- name: "get_cert_facts | Set __deploy_cacerts__ca_intermediate_certs_by_domain fact"
  set_fact:
    __deploy_cacerts__ca_intermediate_certs_by_domain: "{{ __deploy_cacerts__ca_intermediate_certs_by_domain|default({}) | combine( { item.domainName: item } ) }}"
  loop: "{{ deploy_cacerts__ca_intermediate_certs_list }}"

#- name: "get_cert_facts | Set __deploy_cacerts__ca_service_routes"
#  set_fact:
#    __deploy_cacerts__ca_service_routes: "{{ __deploy_cacerts__ca_service_routes|default({}) | combine( { item.route: item } ) }}"
#  loop: "{{ deploy_cacerts__ca_service_routes_list }}"

- name: "get_cert_facts | Set __deploy_cacerts__ca_fetch_domains_list"
  set_fact:
    __deploy_cacerts__ca_fetch_domains_list: "{{ (deploy_cacerts__ca_domains_hosted + __deploy_cacerts__ca_intermediate_certs_by_domain.keys()|list)|flatten|unique }}"
