---

- name: "Init __apply_common_groups__systemd_running"
  set_fact:
    __apply_common_groups__systemd_status: "apply_common_groups__systemd_not_running"

- name: "Wait for systemd to complete initialization."  # noqa 303
  when: ansible_service_mgr == 'systemd'
  command: systemctl is-system-running
  register: systemctl_status
  changed_when: false
  failed_when: systemctl_status.rc > 1

- name: "Display systemctl_status"
  debug:
    var: systemctl_status

#- name: "Display systemctl_status.stdout"
#  debug:
#    var: systemctl_status.stdout

## to get systemd status from shell command:
## `systemctl is-system-running`
- name: "Set __apply_common_groups__systemd_running"
  when: >
    'running' in systemctl_status.stdout or
    'starting' in systemctl_status.stdout or
    'degraded' in systemctl_status.stdout
  set_fact:
    __apply_common_groups__systemd_status: __apply_common_groups__systemd_running

- name: "Group hosts based on __apply_common_groups__systemd_status"
  changed_when: no
  group_by:
    key: "{{ __apply_common_groups__systemd_status }}"
