---

- include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}-{{ ansible_distribution_major_version}}.yml"
    - "{{ ansible_distribution }}.yml"
    - "{{ ansible_os_family }}.yml"
    - "default.yml"

- name: "Setup dns"
  when:
    - bootstrap_linux_core__setup_dns|d(True)|bool
#    - ansible_virtualization_type not in ['docker','container','containerd']
  include_tasks: dns.yml

- name: Setup network
  include_tasks: network.yml
  when: bootstrap_linux_core__init_network|bool

- name: "Setup environment"
  include_tasks: env.yml

- name: "Setup motd"
  include_tasks: motd.yml

- name: "Setup figurine"
  when:
    - bootstrap_linux_core__setup_figurine|d(True)|bool
#    - ansible_virtualization_type not in ['docker','container','containerd']
  include_tasks: figurine.yml

- name: "Setup host name"
  when:
    - bootstrap_linux_core__setup_hostname|d(True)|bool
#    - ansible_virtualization_type not in ['docker','container','containerd']
  include_tasks: hostname.yml

- name: "Configure journald"
  when:
    - bootstrap_linux_core__setup_journald|d(True)|bool
#    - ansible_virtualization_type not in ['docker','container','containerd']
  include_tasks: journald.yml

- include_tasks: timezone.yml
  when:
    - bootstrap_linux_core__set_timezone|d(True)|bool
    - ansible_virtualization_type not in ['docker','container','containerd']

- name: "Setup admin scripts"
  when: bootstrap_linux_core__setup_admin_scripts|d(False)|bool
  include_tasks: setup-admin-scripts.yml

- name: "Setup backup scripts"
  when: bootstrap_linux_core__setup_backup_scripts|d(False)|bool
  include_tasks: setup-backup-scripts.yml

- name: Ensure sysctl
  when: bootstrap_linux_core__sysctl_configs|d([])|length>0
  include_tasks: sysctl.yml
