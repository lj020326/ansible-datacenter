---

- name: Print common_configs_default_path info
  debug: var=common_configs_default_path

- name: Set path in profile for all users
  copy:
    dest: /etc/profile.d/path.sh
    content: "export PATH={{ common_configs_default_path }}\n"
    force: yes

- name: Set path for sudo
  lineinfile:
    dest: /etc/sudoers
    regexp: "Defaults\\s+secure_path\\s+"
    line: "Defaults    secure_path = {{ common_configs_default_path }}"

- name: Set path in environment
  copy:
    dest: /etc/environment
    content: "PATH={{ common_configs_default_path }}\n"
    force: yes

### ref: https://bugs.launchpad.net/ubuntu/+source/procps/+bug/50093
- name: Create sysctl reboot cron
  when: ansible_os_family == "Debian"
  cron:
    name: "{{ item.name }}"
    special_time: "{{ item.special_time | d(omit) }}"
    job: "{{ item.job }}"
  loop:
    - name: "apply sysctl settings upon reboot"
      special_time: reboot
      job: "sysctl -p"
#    - name: "apply sysctl settings upon reboot"
#      special_time: reboot
#      job: "sleep 5 && sysctl -p"
#    - name: "apply sysctl settings upon reboot"
#      special_time: reboot
#      job: "sleep 10 && sysctl -p"
#    - name: "apply sysctl settings upon reboot"
#      special_time: reboot
#      job: "sleep 30 && sysctl -p"

### ref: https://github.com/tumf/ansible-role-systemd-service
#- name: "Update systemd-sysctl service"
#  when: ansible_os_family in ['Debian', 'RedHat']
#  include_role:
#    name: tumf.systemd-service
#  vars:
#    systemd_service_name: "systemd-sysctl"
#    systemd_service_Unit_Description: "Apply Kernel Variables"
#    systemd_service_Unit_Documentation: "man:systemd-sysctl.service(8) man:sysctl.d(5)"
#    systemd_service_Unit_After: "systemd-modules-load.service"
#    systemd_service_Unit_Before: "sysinit.target shutdown.target"
#    systemd_service_Service_Type: "oneshot"
#    systemd_service_Service_ExecStart: "{{ systemd_sysctl_execstart }}"
#    systemd_service_Install_WantedBy:
##    systemd_service_Service_RestartSec: 10

#- name: Setting SELINUX to permissive
#  tags:
#   - configuration
#   - perms
#   - selinux
#  selinux:
##    conf: '/etc/selinux/config'
#    policy: 'targeted'
#    state: 'permissive'
#  when: ansible_os_family == 'RedHat'
