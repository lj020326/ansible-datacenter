---

- name: "Display bootstrap_linux_core__default_path"
  debug:
    var: bootstrap_linux_core__default_path

- name: Set path in profile for all users
  copy:
    dest: /etc/profile.d/path.sh
    content: "export PATH={{ bootstrap_linux_core__default_path }}\n"
    force: yes

- name: Touch /etc/sudoers
  file:
    path: /etc/sudoers
    state: touch

- name: Set path for sudo
  lineinfile:
    dest: /etc/sudoers
    regexp: "Defaults\\s+secure_path\\s+"
    line: "Defaults    secure_path = {{ bootstrap_linux_core__default_path }}"

- name: Set path in environment
  copy:
    dest: /etc/environment
    content: "PATH={{ bootstrap_linux_core__default_path }}\n"
    force: yes

### ref: https://bugs.launchpad.net/ubuntu/+source/procps/+bug/50093
- name: Create sysctl reboot cron
  when:
    - ansible_os_family == "Debian"
    - ansible_virtualization_type not in ['docker','container','containerd']
  cron:
    name: "{{ item.name }}"
    special_time: "{{ item.special_time | d(omit) }}"
    job: "{{ item.job }}"
  loop:
    - name: "apply sysctl settings upon reboot"
      special_time: reboot
      job: "sysctl -p"
#    - name: "apply sysctl settings upon reboot"
#      special_time: reboot
#      job: "sleep 5 && sysctl -p"
#    - name: "apply sysctl settings upon reboot"
#      special_time: reboot
#      job: "sleep 10 && sysctl -p"
#    - name: "apply sysctl settings upon reboot"
#      special_time: reboot
#      job: "sleep 30 && sysctl -p"

### ref: https://github.com/tumf/ansible-role-systemd-service
#- name: "Update systemd-sysctl service"
#  when: ansible_os_family in ['Debian', 'RedHat']
#  include_role:
#    name: bootstrap-systemd-service
#  vars:
#    bootstrap_systemd_service_name: "systemd-sysctl"
#    bootstrap_systemd_service_Unit_Description: "Apply Kernel Variables"
#    bootstrap_systemd_service_Unit_Documentation: "man:systemd-sysctl.service(8) man:sysctl.d(5)"
#    bootstrap_systemd_service_Unit_After: "systemd-modules-load.service"
#    bootstrap_systemd_service_Unit_Before: "sysinit.target shutdown.target"
#    bootstrap_systemd_service_Service_Type: "oneshot"
#    bootstrap_systemd_service_Service_ExecStart: "{{ bootstrap_linux_core__systemd_sysctl_execstart }}"
#    bootstrap_systemd_service_Install_WantedBy:
##    bootstrap_systemd_service_Service_RestartSec: 10

#- name: Setting SELINUX to permissive
#  tags:
#   - configuration
#   - perms
#   - selinux
#  selinux:
##    conf: '/etc/selinux/config'
#    policy: 'targeted'
#    state: 'permissive'
#  when: ansible_os_family == 'RedHat'
