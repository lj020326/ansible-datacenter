---

- name: "Gather facts for all hosts to apply OS specific group vars for them"
  tags: always
  hosts: all
#  connection: local
#  gather_facts: yes
  roles:
      ## https://github.com/ansible-community/molecule/issues/816#issuecomment-696411525
    - role: apply-os-groups
      changed_when: "'molecule-idempotence-notest' not in ansible_skip_tags"

- name: "Bootstrap linux OS on vm template"
  hosts: os_linux
  connection: local
  become: yes
  roles:
      ## https://github.com/ansible-community/molecule/issues/816#issuecomment-696411525
    - role: bootstrap-linux-user
      changed_when: "'molecule-idempotence-notest' not in ansible_skip_tags"
    - role: bootstrap-linux

- name: "Bootstrap windows OS on vm template"
  hosts: os_windows
  connection: local
  become: yes
  roles:
    - role: bootstrap-windows
