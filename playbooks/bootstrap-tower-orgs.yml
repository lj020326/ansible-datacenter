---
## ref: ../doc/awx-automated-configuration.md

- name: Playbook for Using a Variety of Tower Modules
  hosts: localhost
  gather_facts: false
  collections:
    - awx.awx

  vars:

    tower_organizations:
      - name: "New Org111"
        description: "test org"
        state: present

      - name: "New Org222"
        description: "test org"
        state: present

        inventories:
          - name: "New Inventory"
            description: "test inv"
            state: present

        projects:
          - name: "New Project"
            scm_type: git
            scm_url: https://github.com/ansible/test-playbooks.git
            job_templates:
              - name: "Job Template to Launch"
                inventory: "New Inventory"
                playbook: debug.yml

        credentials:
          - name: 'Example password'
            credential_type: Vault
            inputs:
              vault_password: 'new_password'
          - name: "SCM Credential"
            state: present
            credential_type: Source Control
            inputs:
              username: joe
              password: secret

        teams:
          - name: "Test Team 1"
            description: "test team"
            state: present
#            roles:
#              - role: execute
#                job_template: "Job Template to Launch"
#              - role: read
#                inventory: "New Inventory"
#              - role: use
#                credential: "Example password"
#              - role: use
#                credential: "SCM Credential"

            ## ansible.tower version in sandbox does not support lists - change to singletons
            roles:
              - role: execute
                job_templates:
                - 'Job Template to Launch'
              - role: read
                inventories:
                - name: 'New Inventory'
              - role: use
                credentials:
                - name: 'Example password'
                - name: "SCM Credential"


        teams:
          - name: "Test Team 1"
            description: "test team"
            state: present
            roles:
              - role: execute
                job_templates:
                - 'APP - ReadyAPI - master'
              - role: read
                inventories:
                - name: 'Alsac Inventory'
              - role: use
                credentials:
                - name: 'AppVal Git'
                - name: 'LNX - Ansible'




  roles:
    - role: ansible-tower-config



