---

docker_stack_service_groups__base:
  - name: base
    source: role

#time_server: 0.pool.ntp.org
#time_server: 192.168.0.1
time_server: "{{ gateway_ipv4_subnet_1_2 }}.0.1"

#docker_stack_run_services: no
#docker_stack_traefik_version: v1
#docker_stack_traefik_certprovider_qa: yes

docker_stack_script_dir: "/opt/scripts"

#docker_stack_enable_external_route: yes

docker_stack_http_username: "{{ vault__docker_stack_http_username | d('') }}"
docker_stack_http_password: "{{ vault__docker_stack_http_password | d('') }}"

docker_stack_enable_selfsigned_certs: no
docker_stack_enable_cacerts: yes

#docker_stack_ca_cert_bundle: "{{ ca_cert_bundle }}"
#docker_stack_ca_java_keystore: "{{ ca_java_keystore }}"

docker_registry_username: "{{ registry_username }}"
docker_registry_password: "{{ registry_password }}"

docker_stack_mysql_root_password: "{{ vault__docker_stack_mysql_root_password | d('') }}"
docker_stack_grafana_admin_password: "{{ vault__docker_stack_grafana_admin_password | d('') }}"

############
## LDAP
############
docker_stack_ldap_domain: "{{ docker_stack_internal_root_domain }}"
#docker_stack_ldap_domain: "{{ control_plane_domain }}"

docker_stack_ldap_host: "ldap.{{ docker_stack_ldap_domain }}"
docker_stack_ldap_port: "389"
docker_stack_ldap_endpoint: "{{ docker_stack_ldap_host }}:{{ docker_stack_ldap_port }}"
docker_stack_ldap_uri: "ldap://{{ docker_stack_ldap_endpoint }}"

docker_stack_ldap_domain_parts: |
  [
    {% for domain in docker_stack_ldap_domain | split('.') %}
    "dc={{ domain }}",
    {% endfor %}
  ]

docker_stack_ldap_base_dn: "{{ docker_stack_ldap_domain_parts | join(',') }}"
#docker_stack_ldap_base_dn: "{{ ldap_internal_base_dn }}"
docker_stack_ldap_user_base_dn: "ou=users,{{ docker_stack_ldap_base_dn }}"
docker_stack_ldap_group_base_dn: "ou=groups,{{ docker_stack_ldap_base_dn }}"
#docker_stack_ldap_user_base_dn: "{{ ldap_internal_user_search_base_dn }}"
#docker_stack_ldap_search_user_dn: "{{ ldap_internal_search_user_dn }}"

docker_stack_ldap_root_password: "{{ ldap_root_password | d('password') }}"
docker_stack_ldap_admin_password: "{{ ldap_admin_password | d('password') }}"
docker_stack_ldap_config_password: "{{ ldap_config_password | d('passsword') }}"
docker_stack_ldap_readonly_user: "true"
docker_stack_ldap_readonly_username: "readonly"
docker_stack_ldap_readonly_password: "{{ ldap_readonly_password }}"
#docker_stack_ldap_search_user_password: "{{ ldap_search_user_password }}"

#docker_stack_ldap_user_root_samba_nt_password: "{{ vault__ldap_domain_users['root'].sambaNTPassword }}"
#docker_stack_ldap_user_root_password: "{{ vault__ldap_domain_users['root'].ssha_password }}"

############
## STEPCA
############
stepca_root_ca_fingerprint: "{{ vault__stepca_root_ca_fingerprint | d('') }}"
docker_stepca_enc_key: "{{ vault__docker_stepca_enc_key | d('') }}"

docker_stack_redis_password: "{{ vault__docker_stack_redis_password | d('') }}"

docker_stack_gitea_lfs_jwt_secret: "{{ vault__docker_stack_gitea_lfs_jwt_secret | d('') }}"
docker_stack_gitea_secret_key: "{{ vault__docker_stack_gitea_secret_key | d('') }}"
docker_stack_gitea_internal_token: "{{ vault__docker_stack_gitea_internal_token | d('') }}"
docker_stack_gitea_oauth_jwt_secret: "{{ vault__docker_stack_gitea_oauth_jwt_secret | d('') }}"

docker_stack_healthchecks_email_su_password: "{{ vault__docker_stack_healthchecks_email_su_password | d('') }}"

docker_stack_keycloak_user: "{{ vault__docker_stack_keycloak_user | d('') }}"
docker_stack_keycloak_password: "{{ vault__docker_stack_keycloak_password | d('') }}"

docker_stack_wordpress_db_password: "{{ vault__docker_stack_wordpress_db_password | d('') }}"

docker_stack_jenkins_mgr_pwd_secret: "{{ vault__docker_stack_jenkins_mgr_pwd_secret | d('') }}"
#docker_stack_jenkins_agent_secret: "{{ vault__docker_stack_jenkins_agent_secret | d('') }}"
docker_stack_jenkins_agent_secret: "{{ vault__docker_stack_jenkins_agent_secrets[inventory_hostname] | d('') }}"

docker_stack_jenkins_swarm_username: "{{ jenkins_agent_username }}"
docker_stack_jenkins_swarm_password: "{{ vault__jenkins_agent_password }}"

docker_stack_keycloak_postgres_user: keycloak
docker_stack_keycloak_postgres_password: "{{ vault__docker_stack_keycloak_postgres_password }}"

docker_stack_gitea_postgres_password: "{{ vault__docker_stack_gitea_postgres_password }}"

docker_stack_vnc_passwd: "{{ vault__docker_stack_vnc_passwd }}"

docker_stack_jenkins_vmware_data_dir: /data/datacenter/vmware

docker_stack_service_route_name: "{{ inventory_hostname_short }}"

docker_stack_internal_ssl_cert_dir: "{{ ca_local_cert_dir }}"
docker_stack_internal_ssl_certkey_dir: "{{ ca_local_key_dir }}"

registry_domain: "{{ control_plane_domain }}"

ca_service_route: "{{ docker_stack_internal_domain }}"

docker_stack_stepca_ca_name: "stepca.{{ docker_stack_internal_domain }}"

bind_aliases:
  - "{{ docker_stack_service_route_name if docker_stack_service_route_name != inventory_hostname_short else '' }}"

ca_domains_hosted:
  - "{{ docker_stack_internal_domain }}"

docker_stack_registry_name: "{{ docker_stack_internal_domain }}"
docker_stack_registry_endpoint: "{{ docker_registry }}"

docker_stack_registry_username: "{{ docker_registry_username }}"
docker_stack_registry_password: "{{ docker_registry_password }}"

docker_stack_registry_service_common_name: "{{ docker_stack_internal_domain }}"
docker_stack_registry_users: "{{ registry_users }}"

docker_stack_smtp_address: "mail.johnson.int"
docker_stack_smtp_port: 25

docker_stack_archiva_smtp_host: "{{ docker_stack_smtp_address }}"

docker_stack_gitlab_smtp_address: "{{ docker_stack_smtp_address }}"
docker_stack_gitlab_smtp_port: "{{ docker_stack_smtp_port }}"

docker_stack_email_from: "admin@dettonville.org"
docker_stack_email_to: "admin@dettonville.org"

docker_stack_healthchecks_site_name: "Dettonville HealthChecks"
docker_stack_healthchecks_default_from_email: "{{ docker_stack_email_from }}"
docker_stack_healthchecks_email_host: "{{ docker_stack_smtp_address }}"
docker_stack_healthchecks_email_port: "{{ docker_stack_smtp_port }}"
docker_stack_healthchecks_email_su_email: "{{ docker_stack_email_to }}"

docker_stack_pgadmin_config_use_ldap: yes

docker_stack_pgadmin_config_ldap_server_uri: "{{ ldap_internal_host }}"
docker_stack_pgadmin_config_ldap_base_dn: "{{ ldap_internal_base_dn }}"
docker_stack_pgadmin_config_ldap_search_base_dn: "{{ ldap_internal_user_search_base_dn }}"
#docker_stack_pgadmin_config_ldap_search_filter: "(cn=*)"
docker_stack_pgadmin_config_ldap_search_filter: "(objectClass=user)"

stepca_acme_http_challenge_proxy_port: 8980
docker_stack_acme_http_challenge_proxy_port: "{{ stepca_acme_http_challenge_proxy_port }}"

#docker_stack_compose_http_timeout: 120
docker_stack_compose_http_timeout: 240

docker_source_images: []

###########
## JENKINS
###########
docker_stack_jenkins_ldap_host: "{{ ldap_internal_host }}"
docker_stack_jenkins_ldap_base_dn: "{{ ldap_internal_base_dn }}"
docker_stack_jenkins_jcac_mgr_pwd_secret: "{{ ldap_readonly_password }}"

##########
## stepca
##########

#docker_stack_stepca_image: "media.johnson.int:5000/docker-stepca:latest"


#docker_stack_user_username: "adminuser"
#docker_stack_user_group: "adminuser"

docker_stack_dir: "{{ docker_stack_user_home }}/docker"

#docker_stack_admin_jobs: []

#nfs_exports:
#  - "/srv      192.168.0.0/255.255.0.0(ro,fsid=0,async,nohide,no_subtree_check,crossmnt)"

# docker_stack_service_groups: []
