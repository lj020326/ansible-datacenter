# Paolo Frigo, https://www.scriptinglibrary.com

# This scripts search IIS logs and Windows EventLog for 
# Indicators of compromise (IOC) described in CVE-2019-18935

# https://nvd.nist.gov/vuln/detail/CVE-2019-18935
# https://www.telerik.com/support/kb/aspnet-ajax/details/allows-javascriptserializer-deserialization


$IISLogFolder = "D:\Logs\" 

Write-Output "ANALISING IIS LOGS [$IISLogFolder] FOR CVE-2019-18935 EXPLOITATION ATTEMPTS."

$results = Get-ChildItem $IISLogFolder -Filter "*log" | 
    ForEach-Object {get-content $_.FullName } | 
        Select-String ".*POST \/Telerik\.Web\.UI\.WebResource\.axd.*500.*" -AllMatches

Write-Output ">> $($results.count) results found matching the pattern."


if ($results.count -gt 0){
    $results | ForEach-Object {Write-Output $_}     
}

#https://www.cyber.gov.au/acsc/view-all-content/advisories/advisory-2020-004-remote-code-execution-vulnerability-being-actively-exploited-vulnerable-versions-telerik-ui-sophisticated-actors
Write-Output "ANALYSING WINDOWS EVENT LOG ENTRIES FOR MORE INDICATORS OF SUCCESSFUL EXPLOITATION"
$EventLogEntries =  Get-EventLog -LogName Application -InstanceId 1309 -ErrorAction Ignore #-ComputerName YourIISserver #In case this script does not run locally on the webserver

if ($EventLogEntries){
    $EventLogEntries | Write-Output $_
}
else {
    Write-Output "No results found in the Windows EventLog."
}